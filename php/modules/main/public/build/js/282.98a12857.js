"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[282],{2578:function(e,t,a){a.d(t,{H:function(){return o}});const o=[{key:"staff",title:"员工管理",route:"/companyManagement/staff"},{key:"accounts",title:"账号管理",route:"/companyManagement/accounts"}]},32120:function(e,t,a){a.d(t,{A:function(){return c}});a(44114);var o=a(56768),n=a(90144),r=a(81387),i={__name:"zmNavTabs",props:{active:{type:[Number,String]},tabs:{type:Array,required:!0}},setup(e){const t=(0,r.rd)(),a=(0,n.KR)("index"),i=e;function l(){const e=i.tabs.find((e=>e.key===a.value));e.route&&t.push({path:e.route})}return(0,o.sV)((()=>{i.active?a.value=i.active:a.value=i.tabs[0]?.key})),(t,n)=>{const r=(0,o.g2)("a-tab-pane"),i=(0,o.g2)("a-tabs");return(0,o.uX)(),(0,o.Wv)(i,{"active-key":a.value,"onUpdate:activeKey":n[0]||(n[0]=e=>a.value=e),onChange:l,class:"zm-nav-tabs"},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.tabs,(e=>((0,o.uX)(),(0,o.Wv)(r,{key:e.key,tab:e.title},null,8,["tab"])))),128))])),_:1},8,["active-key"])}}};const l=i;var c=l},27359:function(e,t,a){a.r(t),a.d(t,{default:function(){return w}});var o=a(56768),n=a(90144),r=a(60782),i=a(1576),l=a.n(i),c=a(59804),s=a(17694),u=a(63536),m=a(79907),p=a(32120),d=a(2578),f=a(17875),_=a(8298);const v={class:"zm-main-content"},g={class:"mt16"},x=["onClick"],k=["onClick"],b={key:0,class:"mt8"};var h={__name:"accounts",setup(e){const t=(0,r.Pj)(),a=(0,n.KR)(!1),i=((0,n.KR)(!1),(0,n.KR)(!1),(0,n.KR)([])),h=[{title:"账号",dataIndex:"account"},{title:"备注",dataIndex:"description"},{title:"状态",dataIndex:"exp_status_text"},{title:"角色",dataIndex:"role_name"},{title:"登录",dataIndex:"login_perm"},{title:"过期时间",dataIndex:"exp_time_text"},{title:"操作",dataIndex:"operate",width:120}],y=(0,n.Kh)({current:1,pageSize:10,total:0,pageSizeOptions:["10","20","50","100"],showQuickJumper:!0,showSizeChanger:!0}),S=(0,n.Kh)({visible:!1,saving:!1,record:null,formState:{account:"",password:"",verify_password:"",exp_type:0,exp_time:"",description:""}}),w=(0,o.EW)((()=>t.getters.getUserInfo)),F=[2,3];function C(){H()}function H(){a.value=!0,(0,f.vX)({page:y.current,size:y.pageSize}).then((e=>{let t=e.data.items||[];const a=l()().unix();t.map((e=>{e.exp_time>-1?(e.exp_time_text=l()(1e3*e.exp_time).format("YY-MM-DD HH:mm"),e.exp_status_text=e.exp_time>a?"生效中":"已过期"):(e.exp_time_text="永久有效",e.exp_status_text="生效中"),e.login_perm=1==e.can_login,e.role_name=e?.role_info?.role_name})),i.value=t,y.total=Number(e.data.total)})).finally((()=>{a.value=!1}))}function Y(e){let t=e.login_perm?"开启":"关闭";const a=()=>{e.login_perm=!e.login_perm};c.A.confirm({title:"提示",content:`确认${t}该账号登录权限？`,onOk:()=>{(0,f.$4)({id:e.id,can_login:Number(e.login_perm)}).then((()=>{s.Ay.success(`已${t}`)})).catch((()=>{a()}))},onCancel:()=>{a()}})}function z(e){c.A.confirm({title:"提示",content:"确认删除该账号？",onOk:()=>{(0,f.uN)({id:e.id}).then((()=>{s.Ay.success("已删除"),H()}))}})}function A(e){return e&&e<l()().startOf("day")}function I(e){y.current=e.current,y.pageSize=e.pageSize,H()}function K(){S.visible=!0,S.record=null;for(let e in S.formState)"string"===typeof S.formState[e]&&(S.formState[e]="");S.formState.exp_type=0}function U(e){S.visible=!0,S.record=e;for(let t in S.formState)"string"===typeof S.formState[t]&&(S.formState[t]=e[t]||"");S.formState.verify_password=e.password,e.exp_time>-1?(S.formState.exp_type=1,S.formState.exp_time=l()(1e3*e.exp_time).format("YYYY-MM-DD HH:mm")):(S.formState.exp_type=0,S.formState.exp_time="")}function M(){try{S.saving=!0;for(let t in S.formState)"string"===typeof S.formState[t]&&(S.formState[t]=S.formState[t].trim());if(!S.formState.account)throw"请输入登录账号";if(S.formState.account.length<6)throw"登录账号至少包含6位字符";if(!S.record){if(!S.formState.password)throw"请输入登录密码";if(S.formState.password.length<6)throw"登录密码至少包含6位字符";if(!S.formState.verify_password)throw"请确认登录密码";if(S.formState.verify_password!==S.formState.password)throw"确认密码不一致"}if(1===S.formState.exp_type&&!S.formState.exp_time)throw"请选择过期时间";const e=(0,_.t0)(S.formState);1===S.formState.exp_type?e.exp_time=l()(e.exp_time).unix():e.exp_time=-1,S.record&&(e.id=S.record.id,delete e.password,delete e.verify_password),(0,f.Kq)(e).then((e=>{s.Ay.success("已保存"),S.visible=!1,H()})).finally((()=>{S.saving=!1}))}catch(e){s.Ay.error(e),S.saving=!1}}return(0,o.sV)((()=>{const e=d.H.map((e=>e.key)).indexOf("accounts");-1===F.indexOf(w.value.role_id)&&-1!==e&&d.H.splice(e,1),C()})),(e,t)=>{const r=(0,o.g2)("a-alert"),l=(0,o.g2)("a-button"),c=(0,o.g2)("a-switch"),s=(0,o.g2)("a-table"),f=(0,o.g2)("a-input"),_=(0,o.g2)("a-form-item"),w=(0,o.g2)("a-input-password"),F=(0,o.g2)("a-radio"),C=(0,o.g2)("a-radio-group"),H=(0,o.g2)("a-date-picker"),R=(0,o.g2)("a-textarea"),X=(0,o.g2)("a-form"),D=(0,o.g2)("a-modal");return(0,o.uX)(),(0,o.Wv)(m.A,null,{navbar:(0,o.k6)((()=>[(0,o.bF)(p.A,{tabs:(0,n.R1)(d.H),active:"accounts"},null,8,["tabs"])])),default:(0,o.k6)((()=>[(0,o.Lk)("div",v,[(0,o.bF)(r,{type:"info","show-icon":"",message:"设置关联账号，可用于登录系统，支持设置有效期，账号删除后即失效，不再支持登录"}),(0,o.Lk)("div",g,[(0,o.bF)(l,{type:"primary",icon:(0,o.h)((0,n.R1)(u.A)),onClick:K},{default:(0,o.k6)((()=>t[7]||(t[7]=[(0,o.eW)("新增账号")]))),_:1},8,["icon"])]),(0,o.bF)(s,{class:"mt16",loading:a.value,"data-source":i.value,columns:h,pagination:y,onChange:I},{bodyCell:(0,o.k6)((({column:e,text:t,record:a})=>["login_perm"===e.dataIndex?((0,o.uX)(),(0,o.Wv)(c,{key:0,checked:a.login_perm,"onUpdate:checked":e=>a.login_perm=e,onChange:e=>Y(a),"checked-children":"开","un-checked-children":"关"},null,8,["checked","onUpdate:checked","onChange"])):"operate"===e.dataIndex?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.Lk)("a",{onClick:e=>U(a)},"编辑",8,x),(0,o.Lk)("a",{onClick:e=>z(a),class:"ml8"},"删除",8,k)],64)):(0,o.Q3)("",!0)])),_:1},8,["loading","data-source","pagination"])]),(0,o.bF)(D,{open:S.visible,"onUpdate:open":t[6]||(t[6]=e=>S.visible=e),title:"添加账号","confirm-loading":S.saving,onOk:M,width:"500px"},{default:(0,o.k6)((()=>[(0,o.bF)(X,null,{default:(0,o.k6)((()=>[(0,o.bF)(_,{label:"登录账号"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{value:S.formState.account,"onUpdate:value":t[0]||(t[0]=e=>S.formState.account=e),maxlength:32,placeholder:"请输入登录账号","allow-clear":""},null,8,["value"])])),_:1}),S.record?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)(_,{label:"登录密码"},{default:(0,o.k6)((()=>[(0,o.bF)(w,{value:S.formState.password,"onUpdate:value":t[1]||(t[1]=e=>S.formState.password=e),maxlength:32,placeholder:"请输入登录密码","allow-clear":""},null,8,["value"])])),_:1}),(0,o.bF)(_,{label:"确认密码"},{default:(0,o.k6)((()=>[(0,o.bF)(w,{value:S.formState.verify_password,"onUpdate:value":t[2]||(t[2]=e=>S.formState.verify_password=e),maxlength:32,placeholder:"请确认登录密码","allow-clear":""},null,8,["value"])])),_:1})],64)),(0,o.bF)(_,{label:"过期时间"},{default:(0,o.k6)((()=>[(0,o.bF)(C,{value:S.formState.exp_type,"onUpdate:value":t[3]||(t[3]=e=>S.formState.exp_type=e)},{default:(0,o.k6)((()=>[(0,o.bF)(F,{value:0},{default:(0,o.k6)((()=>t[8]||(t[8]=[(0,o.eW)("永久有效")]))),_:1}),(0,o.bF)(F,{value:1},{default:(0,o.k6)((()=>t[9]||(t[9]=[(0,o.eW)("指定时间")]))),_:1})])),_:1},8,["value"]),1===S.formState.exp_type?((0,o.uX)(),(0,o.CE)("div",b,[(0,o.bF)(H,{value:S.formState.exp_time,"onUpdate:value":t[4]||(t[4]=e=>S.formState.exp_time=e),"disabled-date":A,"show-time":{format:"HH:mm"},"value-format":"YYYY-MM-DD HH:mm",format:"YYYY-MM-DD HH:mm"},null,8,["value"])])):(0,o.Q3)("",!0)])),_:1}),(0,o.bF)(_,{label:"账号备注"},{default:(0,o.k6)((()=>[(0,o.bF)(R,{value:S.formState.description,"onUpdate:value":t[5]||(t[5]=e=>S.formState.description=e),placeholder:"请输入备注","allow-clear":"",autoSize:{minRows:3,maxRows:3}},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["open","confirm-loading"])])),_:1})}}},y=a(71241);const S=(0,y.A)(h,[["__scopeId","data-v-517765ba"]]);var w=S}}]);