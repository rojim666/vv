"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[289],{18306:function(e,t,a){a.r(t),a.d(t,{default:function(){return Z}});a(44114);var l=a(56768),i=a(24232),s=a(90144),o=a.p+"img/set.0cafd9bf.svg",n=a.p+"img/set-active.706ce952.svg",c=a.p+"img/delete.a21ec339.svg",d=a.p+"img/delete-active.413a346f.svg",r=a.p+"img/tag-add.109b34cd.svg",u=a.p+"img/tag-add-active.bcfeccb0.svg",g=a.p+"img/tag-delete.026efdb4.svg",k=a.p+"img/tag-delete-active.922abc94.svg",v=a(63536),p=a(17694),m=a(59804),_=a(8298),y=a(17875),f=a(79907);const h={class:"zm-main-content lexicon-box"},b={class:"statistic-box"},L={class:"statistic-item"},w={class:"statistic-num"},C={class:"statistic-item"},x={class:"statistic-num"},A={class:"header mt16"},F={class:"tag-main"},K={class:"tag-label-box"},R={class:"tag-label-title"},X={class:"tag-label-info"},E={class:"tag-content-box"},I={class:"tag-options-box"},O=["onClick"],T=["onClick"],U={class:"tag-icon-box"},W={class:"tag-icon-add"},z=["onClick"],Q={class:"tag-icon-delete"},$=["onClick"],H=["onClick"];var M={__name:"tag",setup(e){(0,s.KR)(""),(0,s.KR)(!1);const t=(0,s.KR)(!1),a=(0,s.KR)(0),M=(0,s.Kh)({group_name:"",keyword_list:[{id:"",name:"",order:1}],group_id:void 0,order:1}),V=(0,s.KR)(!1),Y=(0,s.KR)([]),Z=(0,s.KR)(!1);function j(e){let t=[];for(let a=0;a<e.length;a++){const l=e[a];t.push({id:l.id,name:l.name,order:l.order})}return t}function q(e){return e.filter((e=>e.name&&""!==e.name.trim()))}const B=e=>{q(M.keyword_list).length===M.keyword_list.length?M.keyword_list.push({id:"",name:"",order:e+2}):p.Ay.error("请输入标签名称")},D=()=>{if(q(M.keyword_list).length===M.keyword_list.length-1)return p.Ay.error("请输入标签名称"),!1;let e=t.value?"编辑":"新建";const a=p.Ay.loading(`正在${e}`);let l={group_name:M.group_name,tag:M.keyword_list,order:M.order};t.value&&(l.group_id=M.group_id,l.tag=j(M.keyword_list)),(0,y.Zg)(l).then((t=>{"success"===t.status&&(p.Ay.success(`${e}完成`),J(),Z.value=!1,S())})).finally((()=>{a()})).catch((e=>{J()}))},G=(0,_.sg)(D,500),J=async()=>{V.value=!0;let e={};await(0,y.g0)(e).then((e=>{"success"===e.status&&(Y.value=e.data||[],a.value=e.data.reduce(((e,t)=>e+t.tag.length),0))})).finally((()=>{V.value=!1}))},N=e=>{M.group_name=e.group_name,M.keyword_list=e.tag,M.group_id=e.group_id,M.order=e.order,t.value=!0,Z.value=!0};function P(e){return e.reduce(((e,t)=>Math.max(e,t.order)),0)}function S(){M.group_name="",M.keyword_list=[{id:"",name:"",order:1}],M.group_id=void 0,M.order=1}const ee=()=>{S(),t.value=!1,M.order=P(Y.value)+1,Z.value=!0};(0,s.KR)(0);const te=e=>{m.A.confirm({content:"删除后，已添加到客户信息的标签也一起删除",okText:"确定",cancelText:"取消",onOk:()=>{const t=p.Ay.loading("正在删除");(0,y.mY)({group_id:e.group_id}).then((()=>{p.Ay.success("操作完成"),J()})).finally((()=>{t()}))}})},ae=(e,t)=>{1!==M.keyword_list.length?m.A.confirm({content:(0,l.h)("div",null,[(0,l.h)("span",{style:"display: inline-block; margin-top: 22px;"},"删除后，已添加到客户信息的标签也一起删除"),(0,l.h)("span",{style:"color: red; display: block; margin-top: 4px;"},"（若标签组内只有1个标签时，删除标签会连带标签组一起删除）")]),okText:"确定",style:"width: 520px;",cancelText:"取消",onOk:()=>{const a=p.Ay.loading("正在删除");if(!e.id)return M.keyword_list.splice(t,1),a(),!1;(0,y.dH)({tag_id:e.id}).then((()=>{p.Ay.success("操作完成"),M.keyword_list.splice(t,1)})).finally((()=>{a()})).catch((e=>{}))}}):p.Ay.error("请至少保留一个")};return(0,l.sV)((()=>{J()})),(e,p)=>{const m=(0,l.g2)("a-button"),_=(0,l.g2)("a-input"),y=(0,l.g2)("a-form-item"),V=(0,l.g2)("a-input-group"),j=(0,l.g2)("a-form"),q=(0,l.g2)("a-modal");return(0,l.uX)(),(0,l.Wv)(f.A,{title:"标签管理"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",h,[(0,l.Lk)("div",b,[(0,l.Lk)("div",L,[p[2]||(p[2]=(0,l.Lk)("div",{class:"statistic-title"},"企微标签数",-1)),(0,l.Lk)("div",w,(0,i.v_)(a.value),1)]),(0,l.Lk)("div",C,[p[3]||(p[3]=(0,l.Lk)("div",{class:"statistic-title"},"企微标签组",-1)),(0,l.Lk)("div",x,(0,i.v_)(Y.value.length),1)])]),(0,l.Lk)("div",A,[(0,l.bF)(m,{type:"primary",onClick:ee},{icon:(0,l.k6)((()=>[(0,l.bF)((0,s.R1)(v.A))])),default:(0,l.k6)((()=>[p[4]||(p[4]=(0,l.eW)(" 新建标签组 "))])),_:1})]),(0,l.Lk)("div",F,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Y.value,(e=>((0,l.uX)(),(0,l.CE)("div",{class:"tag-item",key:e.group_id},[(0,l.Lk)("div",K,[(0,l.Lk)("div",R,(0,i.v_)(e.group_name),1),(0,l.Lk)("div",X,"标签数："+(0,i.v_)(e.tag.length),1)]),(0,l.Lk)("div",E,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.tag,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"tag"},(0,i.v_)(e.name),1)))),128))]),(0,l.Lk)("div",I,[(0,l.Lk)("div",{class:"tag-options",onClick:t=>N(e)},p[5]||(p[5]=[(0,l.Lk)("img",{class:"options-icon",src:o,alt:""},null,-1),(0,l.Lk)("img",{class:"options-icon active",src:n,alt:""},null,-1),(0,l.eW)(" 编辑 ")]),8,O),(0,l.Lk)("div",{class:"tag-options tag-options-delete",onClick:t=>te(e)},p[6]||(p[6]=[(0,l.Lk)("img",{class:"options-icon",src:c,alt:""},null,-1),(0,l.Lk)("img",{class:"options-icon active",src:d,alt:""},null,-1),(0,l.eW)(" 删除 ")]),8,T)])])))),128))]),(0,l.bF)(q,{open:Z.value,"onUpdate:open":p[1]||(p[1]=e=>Z.value=e),title:(t.value?"编辑":"新建")+"标签组",onOk:(0,s.R1)(G)},{default:(0,l.k6)((()=>[(0,l.bF)(j,{class:"login-form",model:M,name:"lexicon",autocomplete:"off",onFinish:(0,s.R1)(G),"label-col":{span:4}},{default:(0,l.k6)((()=>[(0,l.bF)(y,{label:"标签组："},{default:(0,l.k6)((()=>[(0,l.bF)(_,{placeholder:"请输入标签组名称",value:M.group_name,"onUpdate:value":p[0]||(p[0]=e=>M.group_name=e)},null,8,["value"])])),_:1}),(0,l.bF)(y,{label:"标签：",style:{"max-height":"300px",overflow:"auto"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(M.keyword_list,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{class:"list-item",key:t},[(0,l.bF)(V,{compact:""},{default:(0,l.k6)((()=>[(0,l.bF)(_,{placeholder:"请输入标签名称",value:e.name,"onUpdate:value":t=>e.name=t},null,8,["value","onUpdate:value"])])),_:2},1024),(0,l.Lk)("div",U,[(0,l.Lk)("div",W,[p[7]||(p[7]=(0,l.Lk)("img",{class:"tag-icon",src:r,alt:""},null,-1)),(0,l.Lk)("img",{onClick:e=>B(t),class:"tag-icon tag-icon-active",src:u,alt:""},null,8,z)]),(0,l.Lk)("div",Q,[M.keyword_list.length>1?((0,l.uX)(),(0,l.CE)("img",{key:0,onClick:a=>ae(e,t),class:"tag-icon",src:g,alt:""},null,8,$)):(0,l.Q3)("",!0),M.keyword_list.length>1?((0,l.uX)(),(0,l.CE)("img",{key:1,onClick:a=>ae(e,t),class:"tag-icon tag-icon-active",src:k,alt:""},null,8,H)):(0,l.Q3)("",!0)])])])))),128))])),_:1})])),_:1},8,["model","onFinish"])])),_:1},8,["open","title","onOk"])])])),_:1})}}},V=a(71241);const Y=(0,V.A)(M,[["__scopeId","data-v-77d515b7"]]);var Z=Y}}]);