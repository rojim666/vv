"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[127],{8292:function(e,a,s){s.d(a,{A:function(){return u}});var l=s(56768);const t={class:"loading-box"};function n(e,a){const s=(0,l.g2)("a-spin");return(0,l.uX)(),(0,l.CE)("div",t,[(0,l.bF)(s)])}var o=s(71241);const i={},c=(0,o.A)(i,[["render",n],["__scopeId","data-v-3d53ffb8"]]);var u=c},29466:function(e,a,s){s.r(a),s.d(a,{default:function(){return ee}});var l=s(56768),t=s(90144),n=s(81387),o=s(79907),i=s.p+"img/file-storage-cover.e2a0a13f.png";const c={fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",class:"design-iconfont"};function u(e,a){return(0,l.uX)(),(0,l.CE)("svg",c,a[0]||(a[0]=[(0,l.Lk)("path",{d:"M13 8L3 8",stroke:"currentColor","stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),(0,l.Lk)("path",{d:"M9 12L13 8L9 4",stroke:"currentColor","stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}var r=s(71241);const d={},v=(0,r.A)(d,[["render",u]]);var k=v;const _={class:"guide-box"},p={class:"left-block"};var f={__name:"guide-box",emits:["showConfig"],setup(e,{emit:a}){const s=a;function t(){s("showConfig")}return(e,a)=>((0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",_,[(0,l.Lk)("div",p,[a[1]||(a[1]=(0,l.Lk)("div",{class:"title"},"文件存储OSS地址配置",-1)),a[2]||(a[2]=(0,l.Lk)("div",{class:"desc"}," 配置OSS地址后，聊天记录的文件将存储在OSS服务中，本地数据也会同时保存，默认保存7天，7天后自动清除 ",-1)),(0,l.Lk)("div",{class:"oss-item",onClick:t},[a[0]||(a[0]=(0,l.Lk)("span",null,"去配置",-1)),(0,l.bF)(k,{class:"icon"})])]),a[3]||(a[3]=(0,l.Lk)("div",{class:"right-block"},[(0,l.Lk)("img",{class:"cover",src:i})],-1))])]))}};const b=(0,r.A)(f,[["__scopeId","data-v-50e3295c"]]);var y=b,g=s(24232),m=s(17694),h=s(16678),F=s(7403),C=s(6252),L=s(7277);const X=()=>L.Ay.get("/api/cloud-storage-settings/provider-regions"),K=()=>L.Ay.get("/api/cloud-storage-settings"),A=e=>L.Ay.put("/api/cloud-storage-settings",e,{headers:L.f5});var w=s(8298),E=s(8292);const W={key:1,class:"w1200"},S={class:"config-info"},x={class:"config-info"},R={class:"config-info"},z={class:"config-info"},U={class:"config-info"},O={key:0},j={key:1},I={class:"mt24"},q={class:"zm-flex-center"},B={class:"zm-tip-info mt8"},M={key:0},Q={class:"mt24"},V={class:"check-modal-box"},T={key:0,class:"text-center"},D={key:1,class:"text-center"},G={key:2,class:"text-center"},H={class:"zm-tip-info mt4"};var J={__name:"oss-config",setup(e){const a=(0,t.KR)(null),s=(0,t.KR)(!0),n=(0,t.KR)(!1),o=(0,t.KR)(!1),i=(0,t.Kh)({"阿里云":{"cn-hangzhou":{name:"华东1（杭州）",endpoint:"https://oss-cn-hangzhou.aliyuncs.com"}},"腾讯云":{"ap-beijing-1":{name:"北京一区",endpoint:"https://cos.ap-beijing-1.myqcloud.com"}}}),c=(0,t.Kh)({provider:"阿里云",access_key:"",secret_key:"",bucket:"",region:void 0,endpoint:"",local_session_file_retention_days:7}),u={access_key:{message:"请输入Access Key"},secret_key:{message:"请输入Secret Key"},bucket:{message:"请输入Bucket"},region:{message:"请选择地区"},endpoint:{message:"请选择地区Endpoint"},local_session_file_retention_days:{message:"请输入本地文件保存时间"}},r=(0,t.Kh)({visible:!1,status:1,error:""}),d=(0,l.h)(h.A,{style:{fontSize:"28px"},spin:!0}),v=(0,l.EW)((()=>i[c.provider]||{})),k=(0,l.EW)((()=>c.local_session_file_retention_days>-1?c.local_session_file_retention_days:7));function _(){try{s.value=!0,K().then((e=>{let a=e?.data||{};a.access_key&&a.secret_key&&(n.value=!0,o.value=!1,Object.assign(c,a))})).finally((()=>{s.value=!1}))}catch(e){}}function p(){X().then((e=>{let a=e?.data||{};Object.assign(i,a)}))}function f(){c.region?c.endpoint=v?.value?.[c.region].endpoint||"":c.endpoint=""}function b(){c.region=void 0,c.endpoint=""}function y(){""===c.local_session_file_retention_days&&(c.local_session_file_retention_days=7);for(let a in c)if("string"===typeof c[a]&&(c[a]=c[a].trim()),!c[a]&&0!==c[a])return m.Ay.error(u[a]?.message);const e=e=>{setTimeout((()=>{"success"===e.status?r.status=2:(r.status=3,r.error=e.error_message)}),2e3)};r.status=1,r.visible=!0,A(c).then(e).catch(e)}function L(){n.value=!0,o.value=!1,r.visible=!1}function J(){r.visible=!1}return(0,l.sV)((()=>{_(),p()})),(e,u)=>{const p=(0,l.g2)("a-alert"),m=(0,l.g2)("a-form-item"),h=(0,l.g2)("a-button"),X=(0,l.g2)("a-select-option"),K=(0,l.g2)("a-select"),A=(0,l.g2)("a-input"),N=(0,l.g2)("a-input-number"),P=(0,l.g2)("a-form"),Y=(0,l.g2)("a-spin"),Z=(0,l.g2)("a-modal");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(p,{type:"info",class:"alert-box",message:"配置OSS地址后，聊天记录的文件将存储在OSS服务中，同时本地默认保存7天，7天后自动清除","show-icon":""}),s.value?((0,l.uX)(),(0,l.Wv)(E.A,{key:0})):((0,l.uX)(),(0,l.CE)("div",W,[(0,l.bF)(P,{class:"mt24",ref_key:"formRef",ref:a,labelCol:{span:3},wrapperCol:{span:10}},{default:(0,l.k6)((()=>[n.value&&!o.value?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.bF)(m,{label:"云服务商",name:"provider"},{default:(0,l.k6)((()=>[(0,l.eW)((0,g.v_)(c.provider),1)])),_:1}),(0,l.bF)(m,{label:"地区"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",S,(0,g.v_)(c.region),1),(0,l.Lk)("div",x,"endpoint："+(0,g.v_)(c.endpoint),1)])),_:1}),(0,l.bF)(m,{label:"Bucket"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",R,(0,g.v_)((0,t.R1)(w.Xl)(c.bucket)),1)])),_:1}),(0,l.bF)(m,{label:"Access Key"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",z,(0,g.v_)((0,t.R1)(w.Xl)(c.access_key)),1)])),_:1}),(0,l.bF)(m,{label:"Secret Key"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",U,(0,g.v_)((0,t.R1)(w.Xl)(c.secret_key)),1)])),_:1}),(0,l.bF)(m,{label:"本地文件保存时间"},{default:(0,l.k6)((()=>[0===c.local_session_file_retention_days?((0,l.uX)(),(0,l.CE)("span",O,"永久保存")):((0,l.uX)(),(0,l.CE)("span",j,"保存"+(0,g.v_)(k.value)+"天，"+(0,g.v_)(k.value)+"天后自动清除",1))])),_:1}),(0,l.bF)(m,{"wrapper-col":{offset:3,span:10}},{default:(0,l.k6)((()=>[(0,l.Lk)("div",I,[(0,l.bF)(h,{onClick:u[0]||(u[0]=e=>o.value=!0)},{default:(0,l.k6)((()=>u[9]||(u[9]=[(0,l.eW)("修 改")]))),_:1})])])),_:1})],64)):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.bF)(m,{label:"云服务商",name:"provider"},{default:(0,l.k6)((()=>[(0,l.bF)(K,{value:c.provider,"onUpdate:value":u[1]||(u[1]=e=>c.provider=e),onChange:b,placeholder:"请选择云服务商"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i,((e,a)=>((0,l.uX)(),(0,l.Wv)(X,{key:a},{default:(0,l.k6)((()=>[(0,l.eW)((0,g.v_)(a),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1}),(0,l.bF)(m,{label:"地区",name:"region"},{default:(0,l.k6)((()=>[(0,l.bF)(K,{value:c.region,"onUpdate:value":u[2]||(u[2]=e=>c.region=e),onChange:f,placeholder:"请选择地区"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(v.value,((e,a)=>((0,l.uX)(),(0,l.Wv)(X,{key:a},{default:(0,l.k6)((()=>[(0,l.eW)((0,g.v_)(e.name),1)])),_:2},1024)))),128))])),_:1},8,["value"]),(0,l.bF)(m,{label:"Endpoint",name:"endpoint",class:"mt8"},{default:(0,l.k6)((()=>[(0,l.bF)(A,{value:c.endpoint,"onUpdate:value":u[3]||(u[3]=e=>c.endpoint=e),placeholder:"请输入Endpoint"},null,8,["value"])])),_:1})])),_:1}),(0,l.bF)(m,{label:"Bucket",name:"bucket"},{default:(0,l.k6)((()=>[(0,l.bF)(A,{value:c.bucket,"onUpdate:value":u[4]||(u[4]=e=>c.bucket=e),placeholder:"请输入Bucket"},null,8,["value"])])),_:1}),(0,l.bF)(m,{label:"Access Key",name:"access_key"},{default:(0,l.k6)((()=>[(0,l.bF)(A,{value:c.access_key,"onUpdate:value":u[5]||(u[5]=e=>c.access_key=e),placeholder:"请输入Access Key"},null,8,["value"])])),_:1}),(0,l.bF)(m,{label:"Secret Key",name:"secret_key"},{default:(0,l.k6)((()=>[(0,l.bF)(A,{value:c.secret_key,"onUpdate:value":u[6]||(u[6]=e=>c.secret_key=e),placeholder:"Secret Key"},null,8,["value"])])),_:1}),(0,l.bF)(m,{label:"本地文件保存时间",name:"local_session_file_retention_days"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",q,[(0,l.bF)(N,{value:c.local_session_file_retention_days,"onUpdate:value":u[7]||(u[7]=e=>c.local_session_file_retention_days=e),precision:0,min:0,style:{width:"100px"},placeholder:"请输入"},null,8,["value"]),u[10]||(u[10]=(0,l.Lk)("span",{class:"ml8"},"天",-1))]),(0,l.Lk)("div",B,[c.local_session_file_retention_days>0?((0,l.uX)(),(0,l.CE)("span",M," 保存"+(0,g.v_)(k.value)+"天，"+(0,g.v_)(k.value)+"天后自动清除； ",1)):(0,l.Q3)("",!0),u[11]||(u[11]=(0,l.eW)(" 保存时间为0，则表示永久保存 "))])])),_:1}),(0,l.bF)(m,{"wrapper-col":{offset:3,span:10}},{default:(0,l.k6)((()=>[(0,l.Lk)("div",Q,[o.value?((0,l.uX)(),(0,l.Wv)(h,{key:0,onClick:_,class:"mr16"},{default:(0,l.k6)((()=>u[12]||(u[12]=[(0,l.eW)("取 消")]))),_:1})):(0,l.Q3)("",!0),(0,l.bF)(h,{type:"primary",onClick:y},{default:(0,l.k6)((()=>u[13]||(u[13]=[(0,l.eW)("配置完成")]))),_:1})])])),_:1})],64))])),_:1},512)])),(0,l.bF)(Z,{open:r.visible,"onUpdate:open":u[8]||(u[8]=e=>r.visible=e),footer:null,maskClosable:!1,closable:!1},{default:(0,l.k6)((()=>[(0,l.Lk)("div",V,[1==r.status?((0,l.uX)(),(0,l.CE)("div",T,[(0,l.bF)(Y,{indicator:(0,t.R1)(d)},null,8,["indicator"]),u[14]||(u[14]=(0,l.Lk)("div",{class:"tit"},"正在验证配置，请勿关闭",-1))])):2==r.status?((0,l.uX)(),(0,l.CE)("div",D,[(0,l.bF)((0,t.R1)(F.A),{style:{color:"#21A665","font-size":"60px"}}),u[16]||(u[16]=(0,l.Lk)("div",{class:"tit"},"验证成功",-1)),(0,l.bF)(h,{class:"mt16",type:"primary",onClick:L},{default:(0,l.k6)((()=>u[15]||(u[15]=[(0,l.eW)("知道了")]))),_:1})])):((0,l.uX)(),(0,l.CE)("div",G,[(0,l.bF)((0,t.R1)(C.A),{style:{color:"#FF9900","font-size":"60px"}}),u[18]||(u[18]=(0,l.Lk)("div",{class:"tit"},"验证失败",-1)),(0,l.Lk)("div",H,(0,g.v_)(r.error||"未知错误"),1),(0,l.bF)(h,{class:"mt16",type:"primary",onClick:J},{default:(0,l.k6)((()=>u[17]||(u[17]=[(0,l.eW)("修改重新验证")]))),_:1})]))])])),_:1},8,["open"])])}}};const N=(0,r.A)(J,[["__scopeId","data-v-b5b7cfc6"]]);var P=N;const Y={class:"zm-main-content"};var Z={__name:"fileStorage",setup(e){const a=(0,n.lq)(),s=(0,n.rd)(),i=(0,t.KR)(!1),c=(0,t.KR)(!1),u=(0,t.KR)(!1);function r(){try{i.value=!0,K().then((e=>{let a=e?.data||{};a.access_key&&a.secret_key&&(u.value=!0)})).finally((()=>{i.value=!1}))}catch(e){}}function d(){c.value=!0,s.replace({path:a.path,query:{...a.query,config:1}})}return(0,l.sV)((()=>{1==a.query.config&&(c.value=!0),r()})),(e,a)=>((0,l.uX)(),(0,l.Wv)(o.A,{title:"文件存储配置"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",Y,[i.value?((0,l.uX)(),(0,l.Wv)(E.A,{key:0})):u.value||c.value?((0,l.uX)(),(0,l.Wv)(P,{key:1})):((0,l.uX)(),(0,l.Wv)(y,{key:2,onShowConfig:d}))])])),_:1}))}};const $=(0,r.A)(Z,[["__scopeId","data-v-6a4893cf"]]);var ee=$}}]);