"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[196],{2041:function(e,t,a){a.d(t,{A:function(){return s}});var n=a(56768),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"},r=l,i=a(4827);function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){u(e,t,a[t])}))}return e}function u(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c=function(e,t){var a=o({},e,t.attrs);return(0,n.bF)(i.A,o({},a,{icon:r}),null)};c.displayName="SyncOutlined",c.inheritAttrs=!1;var s=c},2578:function(e,t,a){a.d(t,{H:function(){return n}});const n=[{key:"staff",title:"员工管理",route:"/companyManagement/staff"},{key:"accounts",title:"账号管理",route:"/companyManagement/accounts"}]},32120:function(e,t,a){a.d(t,{A:function(){return u}});a(44114);var n=a(56768),l=a(90144),r=a(81387),i={__name:"zmNavTabs",props:{active:{type:[Number,String]},tabs:{type:Array,required:!0}},setup(e){const t=(0,r.rd)(),a=(0,l.KR)("index"),i=e;function o(){const e=i.tabs.find((e=>e.key===a.value));e.route&&t.push({path:e.route})}return(0,n.sV)((()=>{i.active?a.value=i.active:a.value=i.tabs[0]?.key})),(t,l)=>{const r=(0,n.g2)("a-tab-pane"),i=(0,n.g2)("a-tabs");return(0,n.uX)(),(0,n.Wv)(i,{"active-key":a.value,"onUpdate:activeKey":l[0]||(l[0]=e=>a.value=e),onChange:o,class:"zm-nav-tabs"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.tabs,(e=>((0,n.uX)(),(0,n.Wv)(r,{key:e.key,tab:e.title},null,8,["tab"])))),128))])),_:1},8,["active-key"])}}};const o=i;var u=o},16813:function(e,t,a){a.r(t),a.d(t,{default:function(){return O}});var n=a(56768),l=a(90144),r=a(24232),i=a(17767),o=a(60782),u=a(1576),c=a.n(u),s=a(17694),d=a(2041),v=a(79907),p=a(17875),f={__name:"staffDepartmentStruct",emits:["change"],setup(e,{emit:t}){const a=t,r=(0,l.KR)([]),i=(0,l.KR)([]);(0,n.sV)((()=>{o()}));const o=()=>{(0,p.RJ)().then((e=>{let t=e.data||[];t=t.map((e=>u(e))),r.value=t}))},u=(e,t=0)=>{let a=`${t}-${e.department_id}`;return e?.child_node?.length>0&&(e.children=e.child_node.map((e=>u(e,a)))),{key:a,title:e.name,children:e.children}},c=()=>{a("change",i.value)};return(e,t)=>{const a=(0,n.g2)("a-tree");return(0,n.uX)(),(0,n.Wv)(a,{"selected-keys":i.value,"onUpdate:selectedKeys":t[0]||(t[0]=e=>i.value=e),onSelect:c,"block-node":"",showLine:"","tree-data":r.value},null,8,["selected-keys","tree-data"])}}};const m=f;var k=m,y=a(65067),g=a(32120),b=a(2578);const h={class:"container"},_={class:"left-block"},w={class:"header-box"},K={class:"operate-box"},z={class:"zm-flex-between mt8"},C={class:"zm-filter-box"},X={class:"zm-filter-item"},x={key:0,class:"zm-user-info"},F={class:"name"},L={class:"right-block ml16"};var W={__name:"staff",setup(e){const t=(0,o.Pj)(),a=[{dataIndex:"name",title:"员工",width:150},{dataIndex:"cst_total",width:90,title:"客户总数"},{dataIndex:"department_name",width:140,title:"所属部门"},{dataIndex:"tag_name",width:135,title:"员工标签"},{dataIndex:"role_name",width:135,title:"角色"}],u=(0,l.KR)(!1),f=(0,l.KR)(!1),m=(0,l.KR)(1),W=(0,l.KR)([]),A=(0,l.KR)([]),I=(0,l.Kh)({total:0,current:1,pageSize:10,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),O=(0,l.Kh)({keyword:"",auth_status:"",department_id:""}),S=(0,l.Kh)({visible:!1,saving:!1,record:null,role:null}),E=(0,n.EW)((()=>t.getters.getUserInfo)),R=[2,3];(0,n.sV)((()=>{const e=b.H.map((e=>e.key)).indexOf("accounts");-1===R.indexOf(E.value.role_id)&&-1!==e&&b.H.splice(e,1),j(),U()}));const j=()=>{(0,y.Jt)("zm:sync:staff:last:day")!=c()().format("YYYYMMDD")&&(Y(),(0,y.hZ)("zm:sync:staff:last:day",c()().format("YYYYMMDD")))},Y=()=>{const e=s.Ay.loading("正在同步");f.value=!0,(0,p.aN)().then((e=>{s.Ay.success("同步完成")})).finally((()=>{e(),f.value=!1}))},M=()=>{W.value=[],I.total=1,I.current=1,U()},U=()=>{u.value=!0;let e={page:I.current,size:I.pageSize};O.keyword=O.keyword.trim(),O.keyword&&(e.keyword=O.keyword),O.department_id&&(e.department_id=O.department_id),(0,p.Xj)(e).then((e=>{let t=e.data.items||[];t.map((e=>{e.role_name=e?.role_info?.role_name})),W.value=t,I.total=Number(e.data.total)})).finally((()=>{u.value=!1}))},D=e=>{I.current=e.current,I.pageSize=e.pageSize,U()},N=e=>{let t=e[0]||null;if(t){let e=t.split("-");O.department_id=e.slice(-1)[0]}M()},P=()=>{S.saving=!0,(0,p.Ne)({id:S.record.id,role_id:S.role}).then((()=>{U(),s.Ay.success("操作完成"),S.visible=!1})).finally((()=>{S.saving=!1}))};return(e,t)=>{const o=(0,n.g2)("a-button"),c=(0,n.g2)("a-input-search"),s=(0,n.g2)("a-tag"),p=(0,n.g2)("a-popover"),y=(0,n.g2)("a-table"),E=(0,n.g2)("a-tab-pane"),R=(0,n.g2)("a-tabs"),j=(0,n.g2)("a-select-option"),U=(0,n.g2)("a-select"),H=(0,n.g2)("a-form-item"),V=(0,n.g2)("a-form"),J=(0,n.g2)("a-modal");return(0,n.uX)(),(0,n.Wv)(v.A,null,{navbar:(0,n.k6)((()=>[(0,n.bF)(g.A,{tabs:(0,l.R1)(b.H),active:"staff"},null,8,["tabs"])])),default:(0,n.k6)((()=>[(0,n.Lk)("div",h,[(0,n.Lk)("div",_,[(0,n.Lk)("div",w,[(0,n.Lk)("div",K,[(0,n.bF)(o,{type:"primary",loading:f.value,icon:(0,n.h)((0,l.R1)(d.A)),onClick:Y},{default:(0,n.k6)((()=>t[4]||(t[4]=[(0,n.eW)(" 同步员工和部门 ")]))),_:1},8,["loading","icon"])]),(0,n.Lk)("div",z,[(0,n.Lk)("div",null,[t[5]||(t[5]=(0,n.eW)("总员工数：")),(0,n.Lk)("strong",null,(0,r.v_)(I.total),1)]),(0,n.Lk)("div",C,[(0,n.Lk)("div",X,[t[6]||(t[6]=(0,n.Lk)("div",{class:"zm-filter-label"},"搜索员工：",-1)),(0,n.bF)(c,{style:{width:"200px"},placeholder:"请输入昵称或别名搜索",value:O.keyword,"onUpdate:value":t[0]||(t[0]=e=>O.keyword=e),allowClear:"",onSearch:M},null,8,["value"])])])])]),(0,n.bF)(y,{class:"mt16",loading:u.value,"data-source":W.value,columns:a,pagination:I,onChange:D},{bodyCell:(0,n.k6)((({column:e,text:a,record:l})=>["name"===e.dataIndex?((0,n.uX)(),(0,n.CE)("div",x,[t[7]||(t[7]=(0,n.Lk)("img",{class:"avatar",src:i},null,-1)),(0,n.Lk)("span",F,(0,r.v_)(l.name),1)])):"tag_name"===e.dataIndex?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[a?.length>3?((0,n.uX)(),(0,n.Wv)(p,{key:0},{content:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a,((e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t},(0,r.v_)(e),1)))),128))])),default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.slice(0,3),((e,t)=>((0,n.uX)(),(0,n.Wv)(s,{key:t},{default:(0,n.k6)((()=>[(0,n.eW)((0,r.v_)(e),1)])),_:2},1024)))),128)),(0,n.Lk)("span",null,"+"+(0,r.v_)(a.length-3),1)])),_:2},1024)):((0,n.uX)(!0),(0,n.CE)(n.FK,{key:1},(0,n.pI)(a,((e,t)=>((0,n.uX)(),(0,n.Wv)(s,{key:t},{default:(0,n.k6)((()=>[(0,n.eW)((0,r.v_)(e),1)])),_:2},1024)))),128))],64)):(0,n.Q3)("",!0)])),_:1},8,["loading","data-source","pagination"])]),(0,n.Lk)("div",L,[(0,n.bF)(R,{activeKey:m.value,"onUpdate:activeKey":t[1]||(t[1]=e=>m.value=e)},{default:(0,n.k6)((()=>[((0,n.uX)(),(0,n.Wv)(E,{key:1,tab:"组织架构"},{default:(0,n.k6)((()=>[(0,n.bF)(k,{onChange:N})])),_:1}))])),_:1},8,["activeKey"])])]),(0,n.bF)(J,{title:"修改角色",open:S.visible,"onUpdate:open":t[3]||(t[3]=e=>S.visible=e),"confirm-loading":S.saving,onOk:P,width:"500px"},{default:(0,n.k6)((()=>[(0,n.bF)(V,null,{default:(0,n.k6)((()=>[(0,n.bF)(H,{label:"选择角色"},{default:(0,n.k6)((()=>[(0,n.bF)(U,{value:S.role,"onUpdate:value":t[2]||(t[2]=e=>S.role=e),placeholder:"请选择角色"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(A.value,(e=>((0,n.uX)(),(0,n.CE)(n.FK,null,[["游客账号","超级管理员"].includes(e.role_name)?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(j,{key:e.id},{default:(0,n.k6)((()=>[(0,n.eW)((0,r.v_)(e.role_name),1)])),_:2},1024))],64)))),256))])),_:1},8,["value"])])),_:1})])),_:1})])),_:1},8,["open","confirm-loading"])])),_:1})}}},A=a(71241);const I=(0,A.A)(W,[["__scopeId","data-v-7ee78c83"]]);var O=I}}]);