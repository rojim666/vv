"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[542],{3188:function(e,t,a){a.d(t,{A:function(){return F}});var s=a(6768),i=a(4232),l=a(144),n=a(4164),d=a(1387);const u={class:"statistic-box"},c={class:"statistic-item"},o={class:"statistic-content-box"},r={class:"statistic-content-item"},m={class:"statistic-content-item-info"},_={class:"statistic-content-item-info-num"},v={class:"statistic-item"},k={class:"statistic-content-box"},y={class:"statistic-content-item"},f={class:"statistic-content-item-info"},p={class:"statistic-content-item-info-num"},b={class:"statistic-item"},g={class:"statistic-content-box"},h={class:"statistic-content-item"},x={class:"statistic-content-item-info"},Y={class:"statistic-content-item-info-num"};var L={__name:"statistic",setup(e){const t=(0,d.lq)(),a=(0,l.KR)(!1),L=(0,l.Kh)({today_num:0,total_num:0,yesterday_num:0}),C=()=>{a.value=!0;let e={};t.query.task_id&&(e.task_id=t.query.task_id),(0,n.Hk)(e).then((e=>{L.today_num=e.data.today_num,L.total_num=e.data.total_num,L.yesterday_num=e.data.yesterday_num})).finally((()=>{a.value=!1}))};return(0,s.sV)((()=>{C()})),(e,t)=>((0,s.uX)(),(0,s.CE)("div",u,[(0,s.Lk)("div",c,[t[0]||(t[0]=(0,s.Lk)("div",{class:"statistic-item-title"},"打标签数",-1)),(0,s.Lk)("div",o,[(0,s.Lk)("div",r,[(0,s.Lk)("div",m,[(0,s.Lk)("div",_,(0,i.v_)(L.total_num),1)])])])]),(0,s.Lk)("div",v,[t[1]||(t[1]=(0,s.Lk)("div",{class:"statistic-item-title"},"今日打标签数",-1)),(0,s.Lk)("div",k,[(0,s.Lk)("div",y,[(0,s.Lk)("div",f,[(0,s.Lk)("div",p,(0,i.v_)(L.today_num),1)])])])]),(0,s.Lk)("div",b,[t[2]||(t[2]=(0,s.Lk)("div",{class:"statistic-item-title"},"昨日打标签数",-1)),(0,s.Lk)("div",g,[(0,s.Lk)("div",h,[(0,s.Lk)("div",x,[(0,s.Lk)("div",Y,(0,i.v_)(L.yesterday_num),1)])])])])]))}},C=a(1241);const w=(0,C.A)(L,[["__scopeId","data-v-29c33bd2"]]);var F=w},4960:function(e,t,a){a.r(t),a.d(t,{default:function(){return A}});var s=a(6768),i=a(144),l=a(1387),n=a(8292),d=a(4232),u=a(7694),c=a(1576),o=a.n(c),r=a(3188),m=a(706),_=a(4164);const v={class:"zm-main-content"},k={class:"statistic-box"},y={class:"detail-header mt16"},f={class:"inline-block ml-8 mr-24 mb-8"},p={class:"inline-block"},b={key:0,class:"user-box"},g=["src"],h={class:"user-name"},x={key:1,class:"msg-type-box"},Y={class:"zm-line-clamp2",style:{"max-height":"40px"}},L={key:0,class:"msg-type-box"},C={class:"zm-line-clamp2",style:{"max-height":"40px"}},w={key:1,class:"msg-type-box"},F=["innerHTML"],M=["onClick"];var D={__name:"detail",setup(e){const t=(0,l.rd)(),a=(0,l.lq)(),n=(0,i.KR)([{dataIndex:"external_name",title:"客户",width:180},{dataIndex:"staff_name",title:"所属员工",width:180},{dataIndex:"keyword",title:"最近触发关键词",width:222},{dataIndex:"msg_time",title:"提交时间",width:130},{dataIndex:"tag_info",title:"标签",width:120}]),c=(0,i.KR)([{label:"全部",value:"all"},{label:"今",value:"today"},{label:"昨",value:"yesterday"},{label:"自定义",value:"custom"}]),D=(0,i.Kh)({dateTab:"all",search_type:1}),I=(0,i.KR)(!1),K=(0,i.KR)([]),X=(0,i.Kh)({total:0,current:1,pageSize:10,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),q=(0,i.Kh)({customer_name:"",staff_userid:[],dates:[]}),z=(0,i.KR)([]),E=(0,i.KR)(null),T=e=>{e&&(z.value=e,q.staff_userid=e.map((e=>e.userid)),A())},A=()=>{K.value=[],X.current=1,X.total=0,W()},R=e=>e&&e>o()().endOf("day"),S=()=>{if(q.dates&&q.dates.length>0){let e=q.dates[1]-q.dates[0];e/864e5>30&&(q.dates=[],u.Ay.warning("发送时间跨度不得超过30天"))}A()},W=()=>{I.value=!0;let e={page:X.current,size:X.pageSize};q.customer_name=q.customer_name.trim(),q.customer_name?e.customer_name=q.customer_name:e.customer_name="",q.staff_userid?e.staff_userid=q.staff_userid[0]:e.staff_userid="",a.query.task_id?e.task_id=a.query.task_id:e.task_id="",q.dates&&q.dates.length&&(e.start_time=o()(q.dates[0]).format("YYYY-MM-DD 00:00:00"),e.end_time=o()(q.dates[1]).format("YYYY-MM-DD 23:59:59")),(0,_.eh)(e).then((e=>{K.value=e.data.items||[],X.total=Number(e.data?.total)})).finally((()=>{I.value=!1})).catch((e=>{}))},O=e=>{let a={};e.group_info?a.group_chat_id=e.group_info.chat_id:(a.conversation_id=e.conversation_id,a.sender=e.from_user_id,a.receiver=e.to_user_id||"",a.sender_type=e.from_role,a.receiver_type=e.to_role);let s=t.resolve({path:"/sessionArchive/index",query:a}).href;window.open(s)},H=()=>{X.current=1,K.value=[],q.customer_name="",q.staff_userid=[],q.dates=[],D.dateTab="all",U()},U=()=>{switch(D.dateTab){case"all":q.dates=[];break;case"today":q.dates=[o()().startOf("day").format("YYYY-MM-DD"),o()().endOf("day").format("YYYY-MM-DD")];break;case"yesterday":q.dates=[o()().subtract(1,"day").startOf("day").format("YYYY-MM-DD"),o()().subtract(1,"day").endOf("day").format("YYYY-MM-DD")];break;default:break}return"custom"!==D.dateTab&&A()},V=e=>{X.current=e.current,X.pageSize=e.pageSize,W()},Q=()=>{W()};return(0,s.sV)((async()=>{a.query.date_type&&(1==a.query.date_type?(D.dateTab="today",U()):2==a.query.date_type?(D.dateTab="yesterday",U()):(D.dateTab="all",U())),a.query.date_type||await Q()})),(e,t)=>{const a=(0,s.g2)("a-input"),l=(0,s.g2)("a-form-item"),u=(0,s.g2)("a-col"),_=(0,s.g2)("a-radio-button"),z=(0,s.g2)("a-radio-group"),W=(0,s.g2)("a-range-picker"),Q=(0,s.g2)("a-button"),j=(0,s.g2)("a-row"),N=(0,s.g2)("a-form"),B=(0,s.g2)("a-table");return(0,s.uX)(),(0,s.CE)("div",v,[(0,s.Lk)("div",k,[(0,s.bF)(r.A)]),(0,s.Lk)("div",y,[(0,s.bF)(N,{model:D,name:"basic",autocomplete:"off"},{default:(0,s.k6)((()=>[(0,s.bF)(j,{type:"flex",justify:"space-around",align:"middle"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{span:6,style:{"padding-right":"24px"}},{default:(0,s.k6)((()=>[(0,s.bF)(l,{label:"搜索客户"},{default:(0,s.k6)((()=>[(0,s.bF)(a,{value:q.customer_name,"onUpdate:value":t[0]||(t[0]=e=>q.customer_name=e),allowClear:"",placeholder:"请输入昵称搜索"},null,8,["value"])])),_:1})])),_:1}),(0,s.bF)(u,{span:18,style:{"padding-right":"24px"}},{default:(0,s.k6)((()=>[(0,s.bF)(l,{label:"提交时间"},{default:(0,s.k6)((()=>[(0,s.bF)(z,{value:D.dateTab,"onUpdate:value":t[1]||(t[1]=e=>D.dateTab=e),onChange:U},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.value,(e=>((0,s.uX)(),(0,s.Wv)(_,{value:e.value,key:e.value},{default:(0,s.k6)((()=>[(0,s.eW)((0,d.v_)(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),(0,s.Lk)("div",f,[(0,s.bF)(W,{value:q.dates,"onUpdate:value":t[2]||(t[2]=e=>q.dates=e),"value-format":"YYYY-MM-DD",class:"w-256",onChange:S,"disabled-date":R},null,8,["value"])]),(0,s.Lk)("div",p,[(0,s.bF)(Q,{onClick:A,type:"primary"},{default:(0,s.k6)((()=>t[4]||(t[4]=[(0,s.eW)("搜索")]))),_:1}),(0,s.bF)(Q,{onClick:H,class:"ml8"},{default:(0,s.k6)((()=>t[5]||(t[5]=[(0,s.eW)("重置")]))),_:1})])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])]),(0,s.bF)(B,{class:"mt16 detail-table",loading:I.value,"data-source":K.value,columns:n.value,pagination:X,onChange:V},{bodyCell:(0,s.k6)((({column:e,text:a,record:l})=>["external_name"===e.dataIndex?((0,s.uX)(),(0,s.CE)("div",b,[(0,s.Lk)("img",{src:l.avatar,class:"avatar"},null,8,g),(0,s.Lk)("div",h,(0,d.v_)(a||"-"),1)])):"tag_info"===e.dataIndex?((0,s.uX)(),(0,s.CE)("div",x,[(0,s.Lk)("div",Y,(0,d.v_)(l.tag.name),1)])):"group_info"===e.dataIndex?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[a?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("div",C,(0,d.v_)(a.name||"-"),1)])):((0,s.uX)(),(0,s.CE)("div",w,t[6]||(t[6]=[(0,s.Lk)("div",{class:"zm-line-clamp2",style:{"max-height":"40px"}},"-",-1)])))],64)):"keyword"===e.dataIndex?((0,s.uX)(),(0,s.CE)("div",{key:3,innerHTML:a,class:"nodestr"},null,8,F)):"msg_time"===e.dataIndex?((0,s.uX)(),(0,s.CE)(s.FK,{key:4},[(0,s.eW)((0,d.v_)((0,i.R1)(o())(a).format("YYYY-MM-DD HH:mm:ss")),1)],64)):"operate"===e.dataIndex?((0,s.uX)(),(0,s.CE)("a",{key:5,class:"operate-content",onClick:e=>O(l)},"聊天明细",8,M)):(0,s.Q3)("",!0)])),_:1},8,["loading","data-source","columns","pagination"]),(0,s.bF)((0,i.R1)(m.A),{selectType:"single",ref_key:"setStaff",ref:E,onChange:t[3]||(t[3]=e=>T(e))},null,512)])}}},I=a(1241);const K=(0,I.A)(D,[["__scopeId","data-v-ce3b6514"]]);var X=K,q=a(4686);const z={class:"sensitive-panel"};var E={__name:"details",setup(e){const t=(0,l.lq)(),a=t.query,d=((0,s.EW)((()=>t.meta.links||[])),(0,i.KR)(!1)),u=()=>{};return(0,s.sV)((()=>{a.task_id&&u()})),(e,t)=>((0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(q.A,{title:[{name:"关键词打标签",route:"/module/keywords_tagging/index"},{name:"数据详情"}]}),(0,s.Lk)("div",z,[d.value?((0,s.uX)(),(0,s.Wv)(n.A,{key:0})):(0,s.Q3)("",!0),(0,s.bF)(X)])]))}};const T=(0,I.A)(E,[["__scopeId","data-v-f464d454"]]);var A=T}}]);