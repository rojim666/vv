"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[100],{7336:function(e,a,t){t.r(a),t.d(a,{default:function(){return G}});var l=t(6768),n=t(4232),s=t(144),r=t(1387),o=t(1576),u=t.n(o),i=t(7694),d={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"}}]},name:"redo",theme:"outlined"},_=d,c=t(4827);function f(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){v(e,a,t[a])}))}return e}function v(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var m=function(e,a){var t=f({},e,a.attrs);return(0,l.bF)(c.A,f({},t,{icon:_}),null)};m.displayName="RedoOutlined",m.inheritAttrs=!1;var p=m,y=t(1644),k=t(7159),g=(t(4114),t(6268)),h={__name:"aselect-staff",props:{width:{type:String,default:"160px"},selectType:{default:"multiple"},isSession:{default:""},isAuthMode:{default:!1},maxTagCount:{type:Number,default:2}},emits:["change"],setup(e,{emit:a}){const t=a,r=(0,s.KR)(null),o=(0,s.KR)(!1),u=(0,s.KR)(!1),i=(0,s.KR)([]),d=(0,s.KR)([]);function _(){o.value=!0,r.value.show(d.value)}function c(e){d.value=e,i.value=e.map((e=>e.userid)),t("change",d.value),v()}function f(){let e=JSON.parse(JSON.stringify(a.value)),a=[];e.map((e=>{i.value.includes(e.userid)&&a.push(e)})),a.value=a,t("change",a.value)}function v(){u.value=!1,o.value=!1}return(a,t)=>{const o=(0,l.g2)("a-select-option"),u=(0,l.g2)("a-select");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(u,{style:(0,n.Tr)({width:e.width}),mode:"multiple",placeholder:"请选择员工",maxTagCount:e.maxTagCount,open:!1,allowClear:"",value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),onChange:f,onDropdownVisibleChange:_},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(d.value,((e,a)=>((0,l.uX)(),(0,l.Wv)(o,{value:e.userid,key:a},{default:(0,l.k6)((()=>[(0,l.Lk)("span",null,(0,n.v_)(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["style","maxTagCount","value"]),(0,l.bF)((0,s.R1)(g.A),{ref_key:"staffRef",ref:r,selectType:e.selectType,isSession:e.isSession,isAuthMode:e.isAuthMode,onSelectStaff:c,onCancel:v},null,8,["selectType","isSession","isAuthMode"])])}}};const b=h;var C=b,x=t(8589),w=t(8298);const L={class:"zm-main-content"},F={class:"filter-box"},W={class:"filter-item"},Y={class:"item-body"},R={class:"filter-item"},I={class:"item-body"},K={class:"filter-item"},O={class:"item-body"},X={class:"filter-item"},A={class:"zm-flex-between"},T={class:"filter-box"},S={key:0,class:"filter-item",style:{"margin-bottom":"0"}},E={class:"item-body"},z={class:"table-box mt16"},M={key:0,class:"zm-user-info"},N=["src"],j={class:"name"},D=["onClick"],$=["onClick"],U=["onClick"],P=["onClick"],Q=["onClick"],J=["onClick"],H=["onClick"];var V={__name:"index",setup(e){const a=t(7767),o=(0,r.rd)(),d=(0,s.KR)([{title:"所属员工",dataIndex:"staff_name",width:120},{dataIndex:"chat_total",width:80},{dataIndex:"eft_chat_no",width:80},{dataIndex:"msg_no_day",width:80},{dataIndex:"no_reply_chat_no",width:100},{dataIndex:"at_rate_avg",width:100},{dataIndex:"rate_avg",width:80}]),_=(0,s.KR)(null),c={year:1,month:1,dateType:1,date:void 0,staff_userid:[],order:""},f=(0,s.KR)(!1),v=(0,s.KR)(!1),m=(0,s.KR)(!1),g=((0,s.KR)(""),(0,s.KR)(1)),h=(0,s.KR)([]),b=(0,s.Kh)({...c}),V=(0,s.Kh)({at_msg_reply_sec:"",msg_reply_sec:"",last_stat_time:"",last_stat_date:""}),q=(0,s.Kh)({current:1,page:1,pageSize:10,total:0,pageSizeOptions:["10","20","50","100"],showQuickJumper:!0,showSizeChanger:!0});async function B(){G(),await te(),le()}function G(){b.year=1,b.month=Number(u()().format("MM"))}function Z(e){b.staff_userid=e.map((e=>e.userid)),ae()}function ee(){Object.assign(b,c),g.value+=1,G(),ae()}function ae(){q.current=1,le()}async function te(){await(0,x.zj)().then((e=>{try{let a=e?.data||{};V.msg_reply_sec=a.msg_reply_sec,V.at_msg_reply_sec=a.at_msg_reply_sec}catch(a){console.error("statRuleDetail error:",a)}}))}function le(){f.value=!0;let e=ne();(0,x.ho)(e).then((e=>{let a=e.data.list||[];a.map((e=>{e.rate_avg=(0,w.gd)(e.rate_avg,1),e.at_rate_avg=(0,w.gd)(e.at_rate_avg,1),e.noreply_rate>0?e.noreply_rate=(100*e.noreply_rate).toFixed(2)+"%":e.noreply_rate=0})),V.last_stat_time=Number(e?.data?.last_stat_time||0),V.last_stat_date=u()(1e3*V.last_stat_time).format("YYYY-MM-DD HH:mm"),h.value=a,q.total=Number(e.data.count)})).finally((()=>{f.value=!1}))}function ne(){let e={page:q.current,size:q.pageSize};switch(b.dateType){case 1:e.stat_time=u()().startOf("day").unix();break;case 2:e.stat_time=u()().subtract(1,"days").startOf("day").unix();break;case 0:b.date&&(e.stat_time=b.date.startOf("day").unix());break}return b.staff_userid.length&&(e.staff_userid=b.staff_userid),b.order&&(e.order=b.order),e}function se(e,a,t){t.field&&t.order?(d.value.map((e=>{e.dataIndex===t.field?e.sortOrder=t.order:e.sortOrder=!1})),b.order=`${t.field} ${"ascend"==t.order?"ASC":"DESC"}`):(d.value.map((e=>e.sortOrder=!1)),b.order=""),Object.assign(q,e),le()}function re(e){let a=1==b.year?Number(u()().format("YYYY")):Number(u()().subtract(1,"year").format("YYYY"));return Number(e.format("YYYY"))!=a||Number(e.format("MM"))!=b.month}function oe(){b.dateType=0,ae()}function ue(){0===b.dateType?(_.value.focus(),b.date=u()(),ae()):(b.date=void 0,G(),ae())}function ie(){let e=1==b.year?Number(u()().format("YYYY")):Number(u()().subtract(1,"year").format("YYYY")),a=b.month<10?"0"+b.month:b.month;b.date=u()(`${e}-${a}-01`),b.dateType=0,ae()}function de(e,a){const t=o.resolve({path:"/module/chat-statistic-group/detail",query:{type:e,staff_userid:a.staff_user_id,staff_name:a.staff_name,stat_time:ne().stat_time||""}});window.open(t.href,"_blank")}function _e(){v.value||(v.value=!0,(0,x.Wl)().then((e=>{ae()})).finally((()=>{v.value=!1})))}function ce(){if(q.total<1)return i.Ay.error("暂无数据");m.value=!0;let e=ne();e.size=5e3,(0,x.ho)(e).then((e=>{let a=e.data.list||[];a.map((e=>{e.rate_avg=(0,w.gd)(e.rate_avg,1),e.at_rate_avg=(0,w.gd)(e.at_rate_avg,1),e.noreply_rate>0&&(e.noreply_rate=(100*e.noreply_rate).toFixed(2)+"%")}));const t=`员工,所在总群,今日新增,活跃群,回复群,总消息,员工消息,未回复,未回复率,@后${V.at_msg_reply_sec}分钟回复率,${V.msg_reply_sec}分钟回复率\n`,l=["staff_name","chat_total","new_chat_total","eft_chat_no","reply_no","msg_no_day","staff_msg_no_day","no_reply_chat_no","noreply_rate","at_rate_avg","rate_avg"];(0,w.Ay)(t,a,l,"员工群聊详情.csv")})).finally((()=>{m.value=!1}))}return(0,l.sV)((()=>{B()})),(e,t)=>{const r=(0,l.g2)("a-select-option"),o=(0,l.g2)("a-select"),u=(0,l.g2)("a-radio-button"),i=(0,l.g2)("a-radio-group"),c=(0,l.g2)("a-date-picker"),v=(0,l.g2)("a-button"),x=(0,l.g2)("a-tooltip"),w=(0,l.g2)("a-table");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(k.A,{active:"index"}),(0,l.Lk)("div",L,[(0,l.Lk)("div",F,[(0,l.Lk)("div",W,[t[6]||(t[6]=(0,l.Lk)("span",{class:"item-label"},"选择时间：",-1)),(0,l.Lk)("div",Y,[(0,l.bF)(o,{value:b.year,"onUpdate:value":t[0]||(t[0]=e=>b.year=e),onChange:ie,style:{width:"80px"}},{default:(0,l.k6)((()=>[(0,l.bF)(r,{value:1},{default:(0,l.k6)((()=>t[4]||(t[4]=[(0,l.eW)("今年")]))),_:1}),(0,l.bF)(r,{value:2},{default:(0,l.k6)((()=>t[5]||(t[5]=[(0,l.eW)("去年")]))),_:1})])),_:1},8,["value"]),(0,l.bF)(o,{value:b.month,"onUpdate:value":t[1]||(t[1]=e=>b.month=e),onChange:ie,style:{width:"80px"}},{default:(0,l.k6)((()=>[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(12,(e=>(0,l.bF)(r,{value:e,key:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e)+"月 ",1)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])]),(0,l.Lk)("div",R,[t[10]||(t[10]=(0,l.Lk)("span",{class:"item-label"},"选择日期：",-1)),(0,l.Lk)("div",I,[(0,l.bF)(i,{value:b.dateType,"onUpdate:value":t[2]||(t[2]=e=>b.dateType=e),onChange:ue},{default:(0,l.k6)((()=>[(0,l.bF)(u,{value:1},{default:(0,l.k6)((()=>t[7]||(t[7]=[(0,l.eW)("今天")]))),_:1}),(0,l.bF)(u,{value:2},{default:(0,l.k6)((()=>t[8]||(t[8]=[(0,l.eW)("昨天")]))),_:1}),(0,l.bF)(u,{value:0},{default:(0,l.k6)((()=>t[9]||(t[9]=[(0,l.eW)("自定义")]))),_:1})])),_:1},8,["value"]),(0,l.bF)(c,{ref_key:"customDateRef",ref:_,style:{width:"160px"},class:"ml8",value:b.date,"onUpdate:value":t[3]||(t[3]=e=>b.date=e),onChange:oe,"disabled-date":re,format:"YYYY-MM-DD"},null,8,["value"])])]),(0,l.Lk)("div",K,[t[11]||(t[11]=(0,l.Lk)("span",{class:"item-label"},"所属员工：",-1)),(0,l.Lk)("div",O,[((0,l.uX)(),(0,l.Wv)(C,{key:g.value,maxTagCount:1,onChange:Z}))])]),(0,l.Lk)("div",X,[(0,l.bF)(v,{type:"primary",onClick:ae},{default:(0,l.k6)((()=>t[12]||(t[12]=[(0,l.eW)("搜 索")]))),_:1}),(0,l.bF)(v,{onClick:ee,class:"ml4"},{default:(0,l.k6)((()=>t[13]||(t[13]=[(0,l.eW)("重 置")]))),_:1})])]),(0,l.Lk)("div",A,[(0,l.Lk)("div",T,[1==b.dateType?((0,l.uX)(),(0,l.CE)("div",S,[t[15]||(t[15]=(0,l.Lk)("span",{class:"item-label",style:{width:"100px"}},"统计截止时间：",-1)),(0,l.Lk)("div",E,[(0,l.eW)((0,n.v_)(V.last_stat_time>0?V.last_stat_date:"--")+" ",1),(0,l.Lk)("a",{class:"ml16",onClick:_e},[(0,l.bF)((0,s.R1)(p)),t[14]||(t[14]=(0,l.eW)("更新"))])])])):(0,l.Q3)("",!0)]),(0,l.bF)(v,{onClick:ce,loading:m.value},{default:(0,l.k6)((()=>t[16]||(t[16]=[(0,l.eW)("导出")]))),_:1},8,["loading"])]),(0,l.Lk)("div",z,[(0,l.bF)(w,{loading:f.value,"data-source":h.value,columns:d.value,scroll:{x:1300},pagination:q,onChange:se},{headerCell:(0,l.k6)((({column:e})=>["chat_total"===e.dataIndex?((0,l.uX)(),(0,l.Wv)(x,{key:0},{title:(0,l.k6)((()=>t[17]||(t[17]=[(0,l.Lk)("span",null,"所在总群数：该员工所在的群聊数",-1),(0,l.Lk)("br",null,null,-1),(0,l.Lk)("span",null,"今日新增：今日新加入的群聊",-1)]))),default:(0,l.k6)((()=>[t[18]||(t[18]=(0,l.eW)(" 所在总群数/今日新增 ")),(0,l.bF)((0,s.R1)(y.A))])),_:1})):"eft_chat_no"===e.dataIndex?((0,l.uX)(),(0,l.Wv)(x,{key:1},{title:(0,l.k6)((()=>t[19]||(t[19]=[(0,l.Lk)("span",null,"活跃群：客户发了消息的群",-1),(0,l.Lk)("br",null,null,-1),(0,l.Lk)("span",null,"回复群：活跃群聊中，回复了消息的群聊",-1)]))),default:(0,l.k6)((()=>[t[20]||(t[20]=(0,l.eW)(" 活跃群/回复群 ")),(0,l.bF)((0,s.R1)(y.A))])),_:1})):"msg_no_day"===e.dataIndex?((0,l.uX)(),(0,l.Wv)(x,{key:2},{title:(0,l.k6)((()=>t[21]||(t[21]=[(0,l.Lk)("span",null,"总消息：员工所在的群聊的全部员工发送的消息",-1),(0,l.Lk)("br",null,null,-1),(0,l.Lk)("span",null,"员工发送：员工所在的群聊中该员工发送的消息数",-1)]))),default:(0,l.k6)((()=>[t[22]||(t[22]=(0,l.eW)(" 总消息/员工发送 ")),(0,l.bF)((0,s.R1)(y.A))])),_:1})):"no_reply_chat_no"===e.dataIndex?((0,l.uX)(),(0,l.Wv)(x,{key:3,title:"员工所在的群聊活跃群聊中未回复消息的群聊数以及占比"},{default:(0,l.k6)((()=>[t[23]||(t[23]=(0,l.eW)(" 未回复/未回复率 ")),(0,l.bF)((0,s.R1)(y.A))])),_:1})):"at_rate_avg"===e.dataIndex?((0,l.uX)(),(0,l.Wv)(x,{key:4,title:`@员工后${V.at_msg_reply_sec}分钟内回复的总轮次/@ 员工后，被@员工回复的总轮次之和，这里轮次是客户发起，员工回复算一轮`},{default:(0,l.k6)((()=>[(0,l.eW)(" @后"+(0,n.v_)(V.at_msg_reply_sec)+"分钟回复率 ",1),(0,l.bF)((0,s.R1)(y.A))])),_:1},8,["title"])):"rate_avg"===e.dataIndex?((0,l.uX)(),(0,l.Wv)(x,{key:5,title:`${V.msg_reply_sec}分钟内回复的总轮次/群的总轮次之和，这里轮次是客户发起，群内员工回复算一轮`},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(V.msg_reply_sec)+"分钟回复率 ",1),(0,l.bF)((0,s.R1)(y.A))])),_:1},8,["title"])):(0,l.Q3)("",!0)])),bodyCell:(0,l.k6)((({column:e,text:r,record:o})=>["staff_name"===e.dataIndex?((0,l.uX)(),(0,l.CE)("div",M,[(0,l.Lk)("img",{class:"avatar",src:o.avatar||(0,s.R1)(a)},null,8,N),(0,l.Lk)("span",j,(0,n.v_)(o.staff_name),1)])):"chat_total"===e.dataIndex?((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.Lk)("a",{onClick:e=>de("all",o)},(0,n.v_)(r),9,D),t[24]||(t[24]=(0,l.eW)(" / ")),(0,l.Lk)("a",{onClick:e=>de("new_room",o)},(0,n.v_)(o.new_chat_total),9,$)],64)):"eft_chat_no"===e.dataIndex?((0,l.uX)(),(0,l.CE)(l.FK,{key:2},[(0,l.Lk)("a",{onClick:e=>de("active_room",o)},(0,n.v_)(r),9,U),t[25]||(t[25]=(0,l.eW)(" / ")),(0,l.Lk)("a",{onClick:e=>de("replay",o)},(0,n.v_)(o.reply_no),9,P)],64)):"msg_no_day"===e.dataIndex?((0,l.uX)(),(0,l.CE)(l.FK,{key:3},[(0,l.eW)((0,n.v_)(r)+" / "+(0,n.v_)(o.staff_msg_no_day),1)],64)):"no_reply_chat_no"===e.dataIndex?((0,l.uX)(),(0,l.CE)(l.FK,{key:4},[(0,l.Lk)("a",{onClick:e=>de("no_replay",o)},(0,n.v_)(r),9,Q),(0,l.eW)(" / "+(0,n.v_)(o.noreply_rate),1)],64)):"at_rate_avg"===e.dataIndex?((0,l.uX)(),(0,l.CE)("a",{key:5,onClick:e=>de("rate_avg",o)},(0,n.v_)(r),9,J)):"rate_avg"===e.dataIndex?((0,l.uX)(),(0,l.CE)("a",{key:6,onClick:e=>de("rate_avg",o)},(0,n.v_)(r),9,H)):(0,l.Q3)("",!0)])),_:1},8,["loading","data-source","columns","pagination"])])])])}}},q=t(1241);const B=(0,q.A)(V,[["__scopeId","data-v-b550da06"]]);var G=B}}]);