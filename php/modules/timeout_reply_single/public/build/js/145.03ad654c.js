"use strict";(self["webpackChunkzmwk_session_archive"]=self["webpackChunkzmwk_session_archive"]||[]).push([[145],{391:function(e,t,l){l.d(t,{Ao:function(){return c},C6:function(){return i},EX:function(){return n},Q4:function(){return s},XP:function(){return u},ji:function(){return m},lS:function(){return r},sn:function(){return o},uM:function(){return d}});var a=l(7277);const n=e=>a.Ay.get("/modules/timeout_reply_single/api/reply-rules",{params:e}),i=e=>a.Ay.post("/modules/timeout_reply_single/api/reply-rules",e),s=e=>a.Ay.get("/modules/timeout_reply_single/api/rules",{params:e}),u=e=>a.Ay.post("/modules/timeout_reply_single/api/rules",e),r=e=>a.Ay.get(`/modules/timeout_reply_single/api/rules/${e}`),o=e=>a.Ay.delete(`/modules/timeout_reply_single/api/rules/${e}`),c=(e,t)=>a.Ay.put(`/modules/timeout_reply_single/api/rules/${e}`,t),d=e=>a.Ay.put(`/modules/timeout_reply_single/api/rules/${e}/enable`),m=e=>a.Ay.put(`/modules/timeout_reply_single/api/rules/${e}/disable`)},1509:function(e,t,l){l.d(t,{A:function(){return L}});l(4114);var a=l(6768),n=l(4232),i=l(144),s=l(2281),u={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},r=u,o=l(4827);function c(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?Object(arguments[t]):{},a=Object.keys(l);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(l).filter((function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable})))),a.forEach((function(t){d(e,t,l[t])}))}return e}function d(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var m=function(e,t){var l=c({},e,t.attrs);return(0,a.bF)(o.A,c({},l,{icon:r}),null)};m.displayName="PlusCircleOutlined",m.inheritAttrs=!1;var p=m,v=l(5226),f=l(3536),g=l(8298);const _={class:"times-range-container"},k={class:"time-range-title"},b={class:"text"},h={class:"time-range-body"},y={class:"times"},w={class:"operator-box ml8"};var C={__name:"timesRange",props:{limit:{type:Number,default:5},timeLimit:{type:Number,default:5},disabled:{type:Boolean,default:!1},showAddBtn:{type:Boolean,default:!0}},emits:["change"],setup(e,{expose:t,emit:l}){const u=l,r=e,o={times:[]},c={week:[],ranges:[(0,g.t0)(o)]},d=(0,i.KR)([{...c}]);function m(){d.value.length>=r.limit||(d.value.push((0,g.t0)(c)),R())}function C(e){r.disabled||1===d.value.length||(d.value.splice(e,1),R())}function F(e){r.disabled||e.ranges.length>=r.timeLimit||(e.ranges.push((0,g.t0)(o)),R())}function A(e,t){r.disabled||1===e.ranges.length||(e.ranges.splice(t,1),R())}function L(e,t){let l;for(let a=0;a<d.value.length;a++)if(l=d.value[a],a!==e&&l.week.includes(t.value))return!0;return!1}function x(){let e=(0,g.t0)(d.value);if(e=e.filter((e=>(e.times=e.ranges.filter((e=>e.times.length>0)),e.week.length>0&&e.times.length>0))),!e.length)return{ok:!1,error:"请至少完善一条时段规则"};for(let t of e){let e=t.ranges.map((e=>[(0,g.EF)(e.times[0]),(0,g.EF)(e.times[1])]));if((0,g.dj)(...e))return{ok:!1,error:"工作时间段存在重叠，请检查后重新选择"}}return{ok:!0}}function X(){let e=(0,g.t0)(d.value);return e=e.filter((e=>(e.times=e.ranges.filter((e=>e.times.length>0)),e.week=e.week.sort(),e.week.length>0&&e.times.length>0))),e}function K(e){e.length&&(d.value=e)}function R(){u("change")}return t({input:K,output:X,verify:x}),(t,l)=>{const u=(0,a.g2)("a-checkbox"),r=(0,a.g2)("a-checkbox-group"),o=(0,a.g2)("a-time-range-picker"),c=(0,a.g2)("a-button");return(0,a.uX)(),(0,a.CE)("div",_,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(d.value,((t,l)=>((0,a.uX)(),(0,a.CE)("div",{class:"time-range-item",key:l},[(0,a.Lk)("div",k,[(0,a.Lk)("span",b,"时间段"+(0,n.v_)(l+1),1),(0,a.bF)((0,i.R1)(s.A),{class:(0,n.C4)(["del",{disabled:e.disabled||d.value.length<2}]),onClick:e=>C(l)},null,8,["class","onClick"])]),(0,a.Lk)("div",h,[(0,a.bF)(r,{value:t.week,"onUpdate:value":e=>t.week=e,disabled:e.disabled,onChange:R},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,i.R1)(g.QM),(e=>((0,a.uX)(),(0,a.Wv)(u,{key:e.value,value:e.value,disabled:L(l,e)},{default:(0,a.k6)((()=>[(0,a.eW)((0,n.v_)(e.label),1)])),_:2},1032,["value","disabled"])))),128))])),_:2},1032,["value","onUpdate:value","disabled"]),(0,a.Lk)("div",y,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.ranges,((l,s)=>((0,a.uX)(),(0,a.CE)("div",{class:"time-item",key:s},[(0,a.bF)(o,{value:l.times,"onUpdate:value":e=>l.times=e,disabled:e.disabled,onChange:R,style:{width:"300px"},format:"HH:mm","value-format":"HH:mm","show-time":{format:"HH:mm"},placeholder:["开始时间","结束时间"]},null,8,["value","onUpdate:value","disabled"]),(0,a.Lk)("div",w,[(0,a.bF)((0,i.R1)(p),{class:(0,n.C4)(["add",{disabled:e.disabled||t.ranges.length>=e.timeLimit}]),onClick:e=>F(t)},null,8,["class","onClick"]),(0,a.bF)((0,i.R1)(v.A),{class:(0,n.C4)(["remove ml8",{disabled:e.disabled||t.ranges.length<2}]),onClick:e=>A(t,s)},null,8,["class","onClick"])])])))),128))])])])))),128)),e.showAddBtn?((0,a.uX)(),(0,a.Wv)(c,{key:0,disabled:e.disabled||d.value.length>=e.limit,type:"dashed",icon:(0,a.h)((0,i.R1)(f.A)),onClick:m,style:{width:"100%"}},{default:(0,a.k6)((()=>l[0]||(l[0]=[(0,a.eW)("添加时间段 ")]))),_:1},8,["disabled","icon"])):(0,a.Q3)("",!0)])}}},F=l(1241);const A=(0,F.A)(C,[["__scopeId","data-v-676c50b6"]]);var L=A},817:function(e,t,l){l.d(t,{A:function(){return d}});var a=l(6768),n=(l(4114),l(144)),i=l(1387),s={__name:"zmNavTabs",props:{active:{type:[Number,String]},tabs:{type:Array,required:!0}},setup(e){const t=(0,i.rd)(),l=(0,n.KR)("index"),s=e;function u(){const e=s.tabs.find((e=>e.key===l.value));e.route&&t.push({path:e.route})}return(0,a.sV)((()=>{s.active?l.value=s.active:l.value=s.tabs[0]?.key})),(t,n)=>{const i=(0,a.g2)("a-tab-pane"),s=(0,a.g2)("a-tabs");return(0,a.uX)(),(0,a.Wv)(s,{"active-key":l.value,"onUpdate:activeKey":n[0]||(n[0]=e=>l.value=e),onChange:u,class:"zm-nav-tabs"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.tabs,(e=>((0,a.uX)(),(0,a.Wv)(i,{key:e.key,tab:e.title},null,8,["tab"])))),128))])),_:1},8,["active-key"])}}};const u=s;var r=u,o={__name:"mainNav",props:{active:{type:[Number,String]}},setup(e){const t=[{key:"index",title:"单聊超时",route:"/module/timeout-reply-single/index"},{key:"rule",title:"回复规则",route:"/module/timeout-reply-single/rule"}];return(l,n)=>((0,a.uX)(),(0,a.Wv)(r,{tabs:t,active:e.active},null,8,["active"]))}};const c=o;var d=c},3145:function(e,t,l){l.r(t),l.d(t,{default:function(){return w}});l(4114);var a=l(6768),n=l(5130),i=l(4232),s=l(144),u=l(1387),r=l(7694),o=l(817),c=l(1509),d=l(391),m=l(8298);const p={class:"zm-main-box"},v={class:"main-body"},f={class:"keyword-tags"},g={class:"keyword-tags"},_={class:"zm-fixed-bottom-box in-module"},k={class:"mt16 text-right"};var b={__name:"rule",setup(e){const t=(0,u.rd)(),l=(0,s.KR)(null),b=(0,s.KR)(!1),h=(0,s.KR)(!1),y=(0,s.KR)(!1),w=((0,s.KR)([]),(0,s.Kh)({keywords_full:"",keywords_half:""})),C=(0,s.Kh)({filter_full_match_word_list:[],filter_half_match_word_list:[],include_image_msg:!1,include_emoji_msg:!1,include_emoticons_msg:!1}),F=(0,s.KR)(null);async function A(){h.value=!0,await(0,d.EX)().then((e=>{let t=e.data||{};(0,m.AB)(C,t);let n=t.working_hours||[];n=n.map((e=>{let t=e.time_period_list.map((e=>({times:[e.start,e.end]})));return{week:e.week_day_list,ranges:t}})),l.value.input(n),(0,a.dY)((()=>{F.value=JSON.stringify({config:C,timeData:l.value.output()})}))})).finally((()=>{h.value=!1}))}function L(){if(F.value){let e=JSON.stringify({config:C,timeData:l.value.output()});F.value!=e?b.value=!0:b.value=!1}}function x(e){try{let t=`filter_${e}_match_word_list`,l=`keywords_${e}`;w[l]=w[l].trim();let a=w[l];if(!a)return;if(C[t].length>=20)throw"每项最多输入20个关键词";if(C[t].includes(a))throw"请勿重复输入";C[t].push(a),w[l]=""}catch(t){r.Ay.error(t)}}function X(e,t,l){l.preventDefault(),C[`filter_${e}_match_word_list`].splice(t,1)}function K(){t.push({path:"/module/timeout-reply-single/index"})}async function R(){try{y.value=!0;let e=l.value.verify();if(!e.ok)throw e.error;let t=l.value.output();t=t.map((e=>{let t=e.ranges.map((e=>({start:e.times[0],end:e.times[1]})));return{week_day_list:e.week,time_period_list:t}})),await(0,d.C6)({...C,working_hours:t}),await A(),b.value=!1,r.Ay.success("已保存")}catch(e){"string"===typeof e&&r.Ay.error(e)}y.value=!1}return(0,a.sV)((()=>{A()})),(0,a.wB)(C,((e,t)=>{L()}),{deep:!0}),(e,t)=>{const s=(0,a.g2)("a-card"),u=(0,a.g2)("a-alert"),r=(0,a.g2)("a-input"),d=(0,a.g2)("a-tag"),m=(0,a.g2)("a-form-item"),h=(0,a.g2)("a-checkbox"),F=(0,a.g2)("a-button"),A=(0,a.g2)("a-popover");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(o.A,{active:"rule"}),(0,a.Lk)("div",p,[(0,a.bF)(s,{bordered:!1},{title:(0,a.k6)((()=>t[10]||(t[10]=[(0,a.Lk)("div",{class:"card-title"},[(0,a.Lk)("span",{class:"title"},"工作时间段设置"),(0,a.Lk)("span",{class:"desc"},"设置工作时间段后，则仅对设定的时间段内对开启会话存档的员工和客户单聊进行工作质量检测")],-1)]))),default:(0,a.k6)((()=>[(0,a.bF)(c.A,{ref_key:"timeRangeRef",ref:l,onChange:L},null,512)])),_:1}),(0,a.bF)(s,{bordered:!1},{title:(0,a.k6)((()=>t[11]||(t[11]=[(0,a.Lk)("div",{class:"card-title"},[(0,a.Lk)("span",{class:"title"},"关键词规则"),(0,a.Lk)("span",{class:"desc"},"设置关键词后，客户发送的最后一条消息触发后员工没有回复不计入超时回复，不会触发提醒")],-1)]))),default:(0,a.k6)((()=>[(0,a.Lk)("div",v,[(0,a.bF)(u,{type:"info","show-icon":!1,banner:"",message:"客户关键字：单聊时，客户发送的最后一条消息匹配到关键词或消息类型匹配为选中类型，且员工没有回复，不算作未回复消息"}),(0,a.bF)(m,{label:"全匹配",class:"mt24"},{default:(0,a.k6)((()=>[(0,a.bF)(r,{placeholder:"请输入自定义匹配关键词","max-length":20,value:w.keywords_full,"onUpdate:value":t[0]||(t[0]=e=>w.keywords_full=e),onKeydown:t[1]||(t[1]=(0,n.jR)((e=>x("full")),["enter"])),onBlur:t[2]||(t[2]=e=>x("full")),style:{width:"360px"}},null,8,["value"]),(0,a.Lk)("div",f,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(C.filter_full_match_word_list,((e,t)=>((0,a.uX)(),(0,a.Wv)(d,{class:"zm-customize-tag",closable:"",onClose:e=>X("full",t,e),key:t},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e),1)])),_:2},1032,["onClose"])))),128))])])),_:1}),(0,a.bF)(m,{label:"半匹配"},{default:(0,a.k6)((()=>[(0,a.bF)(r,{placeholder:"请输入自定义匹配关键词","max-length":20,value:w.keywords_half,"onUpdate:value":t[3]||(t[3]=e=>w.keywords_half=e),onKeydown:t[4]||(t[4]=(0,n.jR)((e=>x("half")),["enter"])),onBlur:t[5]||(t[5]=e=>x("half")),style:{width:"360px"}},null,8,["value"]),(0,a.Lk)("div",g,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(C.filter_half_match_word_list,((e,t)=>((0,a.uX)(),(0,a.Wv)(d,{class:"zm-customize-tag",closable:"",onClose:e=>X("half",t,e),key:t},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e),1)])),_:2},1032,["onClose"])))),128))])])),_:1}),(0,a.bF)(m,{label:"消息类型",style:{"margin-bottom":"0"}},{default:(0,a.k6)((()=>[(0,a.bF)(h,{checked:C.include_image_msg,"onUpdate:checked":t[6]||(t[6]=e=>C.include_image_msg=e)},{default:(0,a.k6)((()=>t[12]||(t[12]=[(0,a.eW)("图片")]))),_:1},8,["checked"]),(0,a.bF)(h,{checked:C.include_emoji_msg,"onUpdate:checked":t[7]||(t[7]=e=>C.include_emoji_msg=e)},{default:(0,a.k6)((()=>t[13]||(t[13]=[(0,a.eW)("emoji")]))),_:1},8,["checked"]),(0,a.bF)(h,{checked:C.include_emoticons_msg,"onUpdate:checked":t[8]||(t[8]=e=>C.include_emoticons_msg=e)},{default:(0,a.k6)((()=>t[14]||(t[14]=[(0,a.eW)("表情包")]))),_:1},8,["checked"])])),_:1}),(0,a.Lk)("div",_,[(0,a.bF)(F,{onClick:K},{default:(0,a.k6)((()=>t[15]||(t[15]=[(0,a.eW)("取 消")]))),_:1}),(0,a.bF)(A,{open:b.value,"onUpdate:open":t[9]||(t[9]=e=>b.value=e),getPopupContainer:e=>e,overlayClassName:"zm-tip-popover",trigger:"manual",placement:"top",title:"提示"},{content:(0,a.k6)((()=>[t[17]||(t[17]=(0,a.Lk)("div",{class:"zm-nowrap"},"回复规则修改后需保存才可生效",-1)),(0,a.Lk)("div",k,[(0,a.bF)(F,{class:"save-btn",size:"small",onClick:(0,n.D$)(R,["stop"])},{default:(0,a.k6)((()=>t[16]||(t[16]=[(0,a.eW)("立即保存")]))),_:1})])])),default:(0,a.k6)((()=>[(0,a.bF)(F,{type:"primary",class:"ml16",onClick:R,loading:y.value},{default:(0,a.k6)((()=>t[18]||(t[18]=[(0,a.eW)("保 存")]))),_:1},8,["loading"])])),_:1},8,["open","getPopupContainer"])])])])),_:1})])])}}},h=l(1241);const y=(0,h.A)(b,[["__scopeId","data-v-4f6909ae"]]);var w=y}}]);