{"version":3,"file":"js/174.c7091f89.js","mappings":"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","sources":["webpack://zmwk_session_archive/./node_modules/@ant-design/icons-svg/es/asn/SyncOutlined.js","webpack://zmwk_session_archive/./node_modules/@ant-design/icons-vue/es/icons/SyncOutlined.js","webpack://zmwk_session_archive/./src/api/company.js","webpack://zmwk_session_archive/./src/components/company/staffDepartmentStruct.vue","webpack://zmwk_session_archive/./src/components/company/staffDepartmentStruct.vue?1b5e","webpack://zmwk_session_archive/./src/views/companyManagement/staff.vue","webpack://zmwk_session_archive/./src/views/companyManagement/staff.vue?3e09"],"sourcesContent":["// This icon file is generated automatically.\nvar SyncOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z\" } }] }, \"name\": \"sync\", \"theme\": \"outlined\" };\nexport default SyncOutlined;\n","import { createVNode as _createVNode } from \"vue\";\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? Object(arguments[i]) : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport SyncOutlinedSvg from \"@ant-design/icons-svg/es/asn/SyncOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar SyncOutlined = function SyncOutlined(props, context) {\n  var p = _objectSpread({}, props, context.attrs);\n\n  return _createVNode(AntdIcon, _objectSpread({}, p, {\n    \"icon\": SyncOutlinedSvg\n  }), null);\n};\n\nSyncOutlined.displayName = 'SyncOutlined';\nSyncOutlined.inheritAttrs = false;\nexport default SyncOutlined;","import request from \"@/api/request\";\r\n\r\nexport const syncDepartmentStaff = () => {\r\n    return request.get('/api/department/sync')\r\n}\r\n\r\nexport const departmentList = () => {\r\n    return request.get('/api/department/list')\r\n}\r\n\r\nexport const staffList = (data) => {\r\n    return request.get('/api/staff/list', {params: data})\r\n}\r\n\r\nexport const groupsList = (data) => {\r\n    return request.get('/api/groups/list', {params: data})\r\n}\r\n\r\nexport const groupsSync = (data) => {\r\n    return request.get('/api/groups/sync', {params: data})\r\n}\r\n\r\nexport const customersList = (data) => {\r\n    return request.get('/api/customers/list', {params: data})\r\n}\r\n\r\nexport const customersSync = (data) => {\r\n    return request.get('/api/customers/sync', {params: data})\r\n}\r\n","<template>\r\n    <a-tree\r\n        v-model:selected-keys=\"selectedKeys\"\r\n        @select=\"selectChange\"\r\n        block-node\r\n        showLine\r\n        :tree-data=\"data\"\r\n    />\r\n</template>\r\n\r\n<script setup>\r\nimport {onMounted, ref} from 'vue';\r\nimport {departmentList} from \"@/api/company\";\r\n\r\nconst emit = defineEmits(['change']);\r\nconst data = ref([])\r\nconst selectedKeys = ref([])\r\n\r\nonMounted(() => {\r\n    loadData()\r\n})\r\n\r\nconst loadData = () => {\r\n    departmentList().then(res => {\r\n        let list = res.data || []\r\n        list = list.map(item => {\r\n            return getNode(item)\r\n        })\r\n        data.value = list\r\n    })\r\n}\r\n\r\nconst getNode = (department, parentKey = 0) => {\r\n    let key = `${parentKey}-${department.department_id}`\r\n    if (department?.child_node?.length > 0) {\r\n        department.children = department.child_node.map(item => {\r\n            return getNode(item, key)\r\n        })\r\n    }\r\n    return {\r\n        key: key,\r\n        title: department.name,\r\n        children: department.children,\r\n    }\r\n}\r\n\r\nconst selectChange = () => {\r\n    emit('change', selectedKeys.value)\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n\r\n</style>\r\n","import script from \"./staffDepartmentStruct.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./staffDepartmentStruct.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","<template>\r\n    <MainLayout title=\"员工管理\">\r\n        <div class=\"container\">\r\n            <div class=\"left-block\">\r\n                <div class=\"header-box\">\r\n                    <div class=\"operate-box\">\r\n                        <a-button type=\"primary\" :loading=\"syncing\" :icon=\"h(SyncOutlined)\" @click=\"syncStaff\">同步员工和部门</a-button>\r\n                    </div>\r\n                    <div class=\"zm-flex-between mt8\">\r\n                        <div>总员工数：<strong>{{ pagination.total }}</strong></div>\r\n                        <div class=\"zm-filter-box\">\r\n<!--                            <div class=\"zm-filter-item\">-->\r\n<!--                                <div class=\"zm-filter-label\">授权状态：</div>-->\r\n<!--                                <a-select-->\r\n<!--                                    style=\"width: 90px;\" v-model:value=\"filterData.auth_status\" @change=\"search\"-->\r\n<!--                                >-->\r\n<!--                                    <a-select-option-->\r\n<!--                                        v-for=\"item in authStatus\"-->\r\n<!--                                        :key=\"item.value\"-->\r\n<!--                                        :value=\"item.value\">{{ item.title }}-->\r\n<!--                                    </a-select-option>-->\r\n<!--                                </a-select>-->\r\n<!--                            </div>-->\r\n                            <div class=\"zm-filter-item\">\r\n                                <div class=\"zm-filter-label\">搜索员工：</div>\r\n                                <a-input-search\r\n                                    style=\"width: 200px;\" placeholder=\"请输入昵称或别名搜索\"\r\n                                    v-model:value=\"filterData.keyword\"\r\n                                    allowClear\r\n                                    @search=\"search\"\r\n                                ></a-input-search>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <a-table\r\n                    class=\"mt16\"\r\n                    :loading=\"loading\"\r\n                    :data-source=\"list\"\r\n                    :columns=\"columns\"\r\n                    :pagination=\"pagination\"\r\n                    @change=\"tableChange\"\r\n                >\r\n                    <template #bodyCell=\"{ column, text, record }\">\r\n                        <template v-if=\"'name' === column.dataIndex\">\r\n                            <div class=\"zm-user-info\">\r\n                                <img class=\"avatar\" src=\"@/assets/default-avatar.png\"/>\r\n                                <span class=\"name\">{{ record.name }}</span>\r\n                            </div>\r\n                        </template>\r\n                        <template v-else-if=\"'tag_name' === column.dataIndex\">\r\n                            <a-popover v-if=\"text?.length > 3\">\r\n                                <template #content>\r\n                                    <div v-for=\"(name, i) in text\" :key=\"i\">{{name}}</div>\r\n                                </template>\r\n                                <a-tag v-for=\"(name, i) in text.slice(0, 3)\" :key=\"i\">{{name}}</a-tag>\r\n                                <span>+{{text.length - 3}}</span>\r\n                            </a-popover>\r\n                            <template v-else>\r\n                                <a-tag v-for=\"(name, i) in text\" :key=\"i\">{{name}}</a-tag>\r\n                            </template>\r\n                        </template>\r\n                    </template>\r\n                </a-table>\r\n            </div>\r\n            <div class=\"right-block ml16\">\r\n                <a-tabs v-model:activeKey=\"activeKey\">\r\n                    <a-tab-pane :key=\"1\" tab=\"组织架构\">\r\n                        <StaffDepartmentStruct @change=\"departmentChange\"/>\r\n                    </a-tab-pane>\r\n                </a-tabs>\r\n            </div>\r\n        </div>\r\n    </MainLayout>\r\n</template>\r\n\r\n<script setup>\r\nimport {onMounted, ref, reactive, h} from 'vue';\r\nimport dayjs from 'dayjs';\r\nimport {message} from 'ant-design-vue';\r\nimport {SyncOutlined} from '@ant-design/icons-vue';\r\nimport MainLayout from \"@/components/mainLayout.vue\";\r\nimport {staffList, syncDepartmentStaff} from \"@/api/company\";\r\nimport StaffDepartmentStruct from \"@/components/company/staffDepartmentStruct.vue\";\r\nimport {set,get} from \"@/utils/cache\";\r\n\r\nconst authStatus = [\r\n    {title: '全部', value: '',},\r\n    {title: '未授权', value: 0,},\r\n    {title: '已授权', value: 1,},\r\n]\r\nconst columns = [\r\n    {\r\n        dataIndex: 'name',\r\n        title: \"员工\",\r\n        width: 150,\r\n    },\r\n    // {\r\n    //     dataIndex: \"auth_status\",\r\n    //     width: 95,\r\n    //     title: \"授权状态\",\r\n    // },\r\n    {\r\n        dataIndex: \"cst_total\",\r\n        width: 90,\r\n        title: \"客户总数\",\r\n    },\r\n    {\r\n        dataIndex: \"department_name\",\r\n        width: 140,\r\n        title: \"所属部门\",\r\n    },\r\n    {\r\n        dataIndex: \"tag_name\",\r\n        width: 135,\r\n        title: \"员工标签\",\r\n    },\r\n]\r\n\r\nconst loading = ref(false)\r\nconst syncing = ref(false)\r\nconst activeKey = ref(1)\r\nconst list = ref([])\r\nconst pagination = reactive({\r\n    total: 0,\r\n    current: 1,\r\n    pageSize: 10,\r\n    showSizeChanger: true,\r\n    pageSizeOptions: ['10', '20', '50', '100'],\r\n})\r\nconst filterData = reactive({\r\n    keyword: '',\r\n    auth_status: '',\r\n    department_id: '',\r\n})\r\n\r\nonMounted(() => {\r\n    autoSync()\r\n    loadData()\r\n})\r\n\r\nconst autoSync = () => {\r\n    if (get('zm:sync:staff:last:day') !=  dayjs().format('YYYYMMDD')) {\r\n        syncStaff()\r\n        set('zm:sync:staff:last:day', dayjs().format('YYYYMMDD'))\r\n    }\r\n}\r\n\r\nconst syncStaff = () => {\r\n    const loading = message.loading('正在同步')\r\n    syncing.value = true\r\n    syncDepartmentStaff().then(res => {\r\n        message.success('同步完成')\r\n    }).finally(() => {\r\n        loading()\r\n        syncing.value = false\r\n    })\r\n}\r\n\r\nconst search = () => {\r\n    list.value = []\r\n    pagination.total = 1\r\n    pagination.current = 1\r\n    loadData()\r\n}\r\n\r\nconst loadData = () => {\r\n    loading.value = true\r\n    let params = {\r\n        page: pagination.current,\r\n        size: pagination.pageSize\r\n    }\r\n    filterData.keyword = filterData.keyword.trim()\r\n    if (filterData.keyword) {\r\n        params.keyword = filterData.keyword\r\n    }\r\n    if (filterData.department_id) {\r\n        params.department_id = filterData.department_id\r\n    }\r\n    staffList(params).then(res => {\r\n        list.value = res.data.items || []\r\n        pagination.total = Number(res.data.total)\r\n    }).finally(() => {\r\n        loading.value = false\r\n    })\r\n}\r\n\r\nconst tableChange = p => {\r\n    pagination.current = p.current\r\n    pagination.pageSize = p.pageSize\r\n    loadData()\r\n}\r\n\r\nconst departmentChange = select => {\r\n    let key = select[0] || null\r\n    if (key) {\r\n        let ids = key.split('-')\r\n        filterData.department_id = ids.slice(-1)[0]\r\n    }\r\n    search()\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.container {\r\n    display: flex;\r\n    margin: 12px;\r\n\r\n    > div {\r\n        background: #FFF;\r\n        border-radius: 2px;\r\n        overflow-y: scroll;\r\n        height: calc(100vh - 130px);\r\n    }\r\n\r\n    .left-block {\r\n        padding: 12px;\r\n        flex: 1;\r\n    }\r\n\r\n    .right-block {\r\n        flex-shrink: 0;\r\n        width: 16vw;\r\n        max-width: 300px;\r\n\r\n        :deep(.ant-tabs) {\r\n            .ant-tabs-tab {\r\n                margin: 0 12px;\r\n            }\r\n\r\n            .ant-tabs-content {\r\n                padding: 0 12px;\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>\r\n","import script from \"./staff.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./staff.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./staff.vue?vue&type=style&index=0&id=3e991eac&scoped=true&lang=less\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3e991eac\"]])\n\nexport default __exports__"],"names":["SyncOutlined","_objectSpread","target","i","arguments","length","source","Object","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","value","defineProperty","configurable","writable","props","context","p","attrs","_createVNode","AntdIcon","SyncOutlinedSvg","displayName","inheritAttrs","syncDepartmentStaff","request","get","departmentList","staffList","data","params","groupsList","groupsSync","customersList","customersSync","emit","__emit","ref","selectedKeys","onMounted","loadData","then","res","list","map","item","getNode","department","parentKey","department_id","child_node","children","title","name","selectChange","__exports__","columns","dataIndex","width","loading","syncing","activeKey","pagination","reactive","total","current","pageSize","showSizeChanger","pageSizeOptions","filterData","keyword","auth_status","autoSync","dayjs","format","syncStaff","set","message","success","finally","search","page","size","trim","items","Number","tableChange","departmentChange","select","ids","split","slice"],"sourceRoot":""}